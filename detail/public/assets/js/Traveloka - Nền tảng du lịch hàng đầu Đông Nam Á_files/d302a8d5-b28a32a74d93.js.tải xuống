"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3100],{79583:function(e,t,n){n.d(t,{pe:function(){return nu},rY:function(){return nd}});var r,s=n(18998),i=n(3273),a=n(29276),o=n(24601);(u=l||(l={})).NONE="none",u.JOINED="joined",u.INVITED="invited",u.LEFT="left";var u,l,c,h,d,_,p,f,m,v,g=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.state=null,r.role=null,r.isMuted=!1,r.isBlockedByMe=!1,r.isBlockingMe=!1,r.state=(0,s.h)(l,n.state)?n.state:null,r.role=(0,s.h)(s.af,n.role)?n.role:null,n.hasOwnProperty("is_muted")&&(r.isMuted=n.is_muted),n.hasOwnProperty("is_blocked_by_me")&&(r.isBlockedByMe=n.is_blocked_by_me),n.hasOwnProperty("is_blocking_me")&&(r.isBlockingMe=n.is_blocking_me),r}return(0,s._)(t,e),t.payloadify=function(t){return t?(0,s.e)((0,s.l)((0,s.l)({},e.payloadify.call(this,t)),{state:t.state,role:t.role,is_muted:t.isMuted,is_blocked_by_me:t.isBlockedByMe,is_blocking_me:t.isBlockingMe})):null},t}(a.f),y=function(e){function t(t,n){var r,i,a=this;return(a=e.call(this,t)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",a.channelType=null!==(i=n.channel_type)&&void 0!==i?i:s.C.GROUP,a.reader=new s.U(a._iid,n.user),a.readAt=n.ts,a}return(0,s._)(t,e),t}(s.I);(E=c||(c={})).ALL="all",E.PUBLIC="public",E.PRIVATE="private",(C=h||(h={})).ALL="all",C.JOINED="joined_only",C.INVITED="invited_only",C.INVITED_BY_FRIEND="invited_by_friend",C.INVITED_BY_NON_FRIEND="invited_by_non_friend",(b=d||(d={})).ALL="all",b.SUPER="super",b.NON_SUPER="nonsuper",b.BROADCAST_ONLY="broadcast_only",b.EXCLUSIVE_ONLY="exclusive_only",(N=_||(_={})).ALL="all",N.UNREAD_MESSAGE="unread_message",(M=p||(p={})).ALL="all",M.UNHIDDEN="unhidden_only",M.HIDDEN="hidden_only",M.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",M.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide",(S=f||(f={})).ALL="all",S.OPERATOR="operator",S.NONOPERATOR="nonoperator",(T=m||(m={})).AND="AND",T.OR="OR",(A=v||(v={})).MEMBER_NICKNAME="member_nickname",A.CHANNEL_NAME="channel_name";var E,C,b,N,M,S,T,A,U,I=function(){function e(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=h.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=d.ALL,this.publicChannelFilter=c.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=_.ALL,this.hiddenChannelFilter=p.UNHIDDEN,this.includeFrozen=!0}return e.prototype._isFriend=function(e){return!!e.friendDiscoveryKey||!!e.friendName},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=m.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t=new e;this.searchFilter&&t.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&t.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach(function(e){t[e]=n[e]}),t},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,r=n.query,i=n.fields;if(r&&i&&i.length>0&&!i.some(function(t){switch(t){case v.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case v.MEMBER_NICKNAME:return e.members.some(function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())});default:return!0}}))return!1}if(this._userIdsFilter){var a=this._userIdsFilter,o=a.userIds,u=a.includeMode,l=a.queryType,f=e.members.map(function(e){return e.userId});if(u){if(o.length>0)switch(l){case m.AND:if(o.some(function(e){return!f.includes(e)}))return!1;break;case m.OR:if(o.every(function(e){return!f.includes(e)}))return!1}}else if(o.includes(t)||o.push(t),e.members.length>o.length||!(0,s.aH)(o,f))return!1}if(!this.includeEmpty&&!e.lastMessage||!this.includeFrozen&&e.isFrozen||this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType)||this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType)||this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var g=this.nicknameContainsFilter.toLowerCase();if(e.members.every(function(e){return!e.nickname.toLowerCase().includes(g)}))return!1}if(this.nicknameStartsWithFilter){var y=this.nicknameStartsWithFilter.toLowerCase();if(e.members.every(function(e){return!e.nickname.toLowerCase().startsWith(y)}))return!1}if(this.nicknameExactMatchFilter){var E=this.nicknameExactMatchFilter.toLowerCase();if(e.members.every(function(e){return e.nickname.toLowerCase()!=E}))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case h.JOINED:if("joined"!==e.myMemberState)return!1;break;case h.INVITED:if("invited"!==e.myMemberState)return!1;break;case h.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case h.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case p.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case p.HIDDEN:if(!e.isHidden)return!1;break;case p.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case p.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===_.UNREAD_MESSAGE&&0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case c.PUBLIC:if(!e.isPublic)return!1;break;case c.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case d.SUPER:if(!e.isSuper)return!1;break;case d.NON_SUPER:if(e.isSuper)return!1}return!0},e}(),w=function(e){function t(t,n){var r=n.sdkState,s=n.cacheContext,i=e.call(this,t)||this;return i._channels=new Map,i._sdkState=r,i._cacheContext=s,i}return(0,s._)(t,e),Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection(i.N):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e,t){return void 0===t&&(t=0),(0,s.l)((0,s.l)({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},t.prototype._deserialize=function(e){return eB.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(t.prototype,"channels",{get:function(){return(0,s.Z)([],(0,s.Y)(this._channels.values()),!1)},enumerable:!1,configurable:!0}),t.prototype.isCachedInMemory=function(e){return this._channels.has(e)},t.prototype.filterOffsetChanged=function(e){var t=this;return e.filter(function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp})},t.prototype.get=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,null];case 3:return[2,this._channels.get(e)]}})})},t.prototype.fetch=function(e){var t=e.token,n=e.limit,r=void 0===n?i.D:n,a=e.backward,o=void 0!==a&&a,u=e.filter,l=void 0===u?new I:u,c=e.order,h=void 0===c?i.G.LATEST_LAST_MESSAGE:c;return(0,s.j)(this,void 0,void 0,function(){var e,n,a=this;return(0,s.k)(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?(e={where:function(e){if(t)switch(h){case i.G.CHANNEL_NAME_ALPHABETICAL:if(!o&&0>e.name.localeCompare(t)||o&&e.name.localeCompare(t)>0)return!1;break;case i.G.CHRONOLOGICAL:if(!o&&e.createdAt>t||o&&e.createdAt<t)return!1;break;case i.G.LATEST_LAST_MESSAGE:if(!o&&e.lastMessageUpdatedAt>t||o&&e.lastMessageUpdatedAt<t)return!1}return l.match(a._deserialize(e),a._sdkState.userId)},index:(0,i.g)(h),backward:o},[4,this.collection.query(e)]):[3,3];case 1:return[4,s.sent().fetch({limit:r})];case 2:return(n=s.sent().map(function(e){return a._deserialize(e)})).forEach(function(e){a._channels.has(e.url)||a._channels.set(e.url,e)}),[2,n];case 3:return[2,[]]}})})},t.prototype.upsert=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r=this;return(0,s.k)(this,function(s){switch(s.label){case 0:if(e.forEach(function(e){r._channels.has(e.url)?Object.assign(r._channels.get(e.url),e,{_iid:r._iid}):r._channels.set(e.url,e)}),!this.localCacheEnabled)return[3,2];for(n in t=[],e)t.push(this._serialize(e[n],parseInt(n)));return[4,this.collection.upsertMany(t)];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a;return(0,s.k)(this,function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),n=(t=(0,s.z)(e)).next(),o.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return i={error:o.sent()},[3,7];case 6:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}return[7];case 7:return[2]}})})},t.prototype.clear=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.clearMemoryCache=function(){this._channels.clear()},t.prototype._setBlockStateOfAllChannels=function(e,t,n){return(0,s.j)(this,void 0,void 0,function(){var r,i,a,o,u,l,c,h,d,_,p,f,m,v,g,y,E,C,b;return(0,s.k)(this,function(N){switch(N.label){case 0:if(r=[],e===this._sdkState.userId)try{for(a=(i=(0,s.z)(this._channels.values())).next();!a.done;a=i.next()){h=a.value;try{for(v=void 0,u=(o=(0,s.z)(h.members)).next();!u.done;u=o.next())if((p=u.value).userId===t){p.isBlockedByMe=n,r.push(h);break}}catch(e){v={error:e}}finally{try{u&&!u.done&&(g=o.return)&&g.call(o)}finally{if(v)throw v.error}}}}catch(e){f={error:e}}finally{try{a&&!a.done&&(m=i.return)&&m.call(i)}finally{if(f)throw f.error}}else if(t===this._sdkState.userId)try{for(c=(l=(0,s.z)(this._channels.values())).next();!c.done;c=l.next()){h=c.value;try{for(C=void 0,_=(d=(0,s.z)(h.members)).next();!_.done;_=d.next())if((p=_.value).userId===e){p.isBlockingMe=n,r.push(h);break}}catch(e){C={error:e}}finally{try{_&&!_.done&&(b=d.return)&&b.call(d)}finally{if(C)throw C.error}}}}catch(e){y={error:e}}finally{try{c&&!c.done&&(E=l.return)&&E.call(l)}finally{if(y)throw y.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:N.sent(),N.label=2;case 2:return[2]}})})},t.prototype.block=function(e,t){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}})})},t.prototype.unblock=function(e,t){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}})})},t.prototype.markAsRead=function(e,t){return void 0===t&&(t=(0,s.Z)([],(0,s.Y)(this._channels.keys()),!1)),(0,s.j)(this,void 0,void 0,function(){var n,r,i,a,o,u,l;return(0,s.k)(this,function(c){switch(c.label){case 0:n=[],c.label=1;case 1:c.trys.push([1,6,7,8]),i=(r=(0,s.z)(t)).next(),c.label=2;case 2:return i.done?[3,5]:(a=i.value,[4,this.get(a)]);case 3:(o=c.sent())._updateUnreadMemberState(this._sdkState.userId,e)&&(o._updateUnreadCount(0,0),n.push(o)),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return u={error:c.sent()},[3,8];case 7:try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:c.sent(),c.label=10;case 10:return[2]}})})},t}(s.I),k={invitedUserIds:null,channelUrl:null,coverUrl:null,coverImage:null,isDistinct:null,isSuper:null,isBroadcast:null,isExclusive:null,isPublic:null,isDiscoverable:null,isStrict:null,isEphemeral:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},L=function(e){return(0,s.T)("string",e.invitedUserIds,!0)&&(0,s.i)("string",e.channelUrl,!0)&&(0,s.i)("string",e.coverUrl,!0)&&((0,s.q)(e.coverImage)||(0,s.i)("string",e.coverImage)||null===e.coverImage)&&(0,s.i)("boolean",e.isDistinct,!0)&&(0,s.i)("boolean",e.isSuper,!0)&&(0,s.i)("boolean",e.isBroadcast,!0)&&(0,s.i)("boolean",e.isExclusive,!0)&&(0,s.i)("boolean",e.isPublic,!0)&&(0,s.i)("boolean",e.isStrict,!0)&&(0,s.i)("boolean",e.isDiscoverable,!0)&&(0,s.i)("boolean",e.isEphemeral,!0)&&(0,s.i)("string",e.accessCode,!0)&&(0,s.i)("string",e.name,!0)&&(0,s.i)("string",e.data,!0)&&(0,s.i)("string",e.customType,!0)&&(0,s.T)("string",e.operatorUserIds,!0)&&(0,s.i)("number",e.messageSurvivalSeconds,!0)},D={customTypes:null,includeEmpty:!1,includeFrozen:!0},R=function(e){return(0,s.T)("string",e.customTypes,!0)&&(0,s.i)("boolean",e.includeEmpty)&&(0,s.i)("boolean",e.includeFrozen)},P={myMemberStateFilter:h.ALL},O=function(e){return(0,s.h)(h,e.myMemberStateFilter)};(V=U||(U={})).GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",V.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",V.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",V.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",V.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",V.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",V.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",V.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",V.SUPER_INVITATION_COUNT="super_group_channel_invitation_count";var V,F,x={keys:[]},H={channelCustomTypesFilter:null,superChannelFilter:d.ALL},j={channelUrl:null,scheduledStatus:null,messageTypeFilter:s.s.ALL};(eA=F||(F={})).UNKNOWN="UNKNOWN",eA.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",eA.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",eA.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",eA.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",eA.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",eA.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",eA.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",eA.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",eA.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",eA.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",eA.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",eA.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",eA.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",eA.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",eA.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",eA.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",eA.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",eA.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",eA.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",eA.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",eA.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",eA.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",eA.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",eA.REQUEST_CHANNEL="REQUEST_CHANNEL",eA.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",eA.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",eA.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS";var G=function(e){return e.startsWith("EVENT_")||e===F.SYNC_CHANNEL_BACKGROUND||e===F.SYNC_CHANNEL_CHANGELOGS},q=function(e){function t(t){var n=t.channels,r=t.source,s=e.call(this)||this;return s.channels=n,s.source=r,s}return(0,s._)(t,e),t}(s.B),z=function(e){function t(t){var n=t.channelUrls,r=t.source,s=e.call(this)||this;return s.channelUrls=n,s.source=r,s}return(0,s._)(t,e),t}(s.B),K=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,r=e.unsentMessageCache,a=e.dispatcher,o=this;this._observers=new Map,a.on(function(e){return(0,s.j)(o,void 0,void 0,function(){var a,o,u,l,c,h,d,_,p,f,m=this;return(0,s.k)(this,function(v){switch(v.label){case 0:if(!(e instanceof q))return[3,2];a=e.channels,_=e.source,o=a.filter(function(e){return e instanceof t9}),u=t.filterOffsetChanged(o);try{for(c=(l=(0,s.z)(u)).next();!c.done;c=l.next())h=c.value,n.removeUnderOffset(h.url,h.messageOffsetTimestamp)}catch(e){p={error:e}}finally{try{c&&!c.done&&(f=l.return)&&f.call(l)}finally{if(p)throw p.error}}return[4,t.upsert(o)];case 1:return v.sent(),this._broadcastUpdateEvent(o,_),[3,7];case 2:return e instanceof z?(d=e.channelUrls,_=e.source,[4,t.remove(d)]):[3,5];case 3:return v.sent(),[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){var e,t,i,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:u.trys.push([0,6,7,8]),t=(e=(0,s.z)(d)).next(),u.label=1;case 1:return t.done?[3,5]:(i=t.value,[4,n.removeMessagesOfChannel(i)]);case 2:return u.sent(),[4,r.removeMessagesOfChannel(i)];case 3:u.sent(),u.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return a={error:u.sent()},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})})];case 4:return v.sent(),this._broadcastRemoveEvent(d,_),[3,7];case 5:return e instanceof i.a?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,7];case 6:v.sent(),v.label=7;case 7:return[2]}})})})}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onUpdate(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onRemove(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),B=function(){function e(e){var t=e.cacheContext,n=e.messageCache,r=e.unsentMessageCache,i=e.dispatcher,a=e.logger,o=this;this._cacheContext=null,this._observers=new Map,this._logger=null,this._cacheContext=t,this._logger=a,i.on(function(e){return(0,s.j)(o,void 0,void 0,function(){var t,i,a,o,u,l,c,h,d,_,p,f,m=this;return(0,s.k)(this,function(v){switch(v.label){case 0:return e instanceof s.L?(t=e.messages,p=e.source,i=t.filter(function(e){return e.messageId>0}),a=t.filter(function(e){return 0===e.messageId}),i.length>0?[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,n.upsert(i)];case 1:return e.sent(),[4,r.remove(i.map(function(e){return e instanceof s.w?e.reqId:null}).filter(function(e){return null!==e}))];case 2:return e.sent(),[2]}})})})]:[3,2]):[3,5];case 1:v.sent(),this._broadcastUpdateEvent(i,p),v.label=2;case 2:return a.length>0?[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,r.upsert(a)];case 1:return e.sent(),[2]}})})})]:[3,4];case 3:v.sent(),this._broadcastUpdateEvent(a,p),v.label=4;case 4:return[3,21];case 5:return e instanceof s.aN?(o=e.messageIds,p=e.source,[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,n.remove(o)];case 1:return e.sent(),[2]}})})})]):[3,7];case 6:return v.sent(),this._broadcastRemoveEvent(o,p),[3,21];case 7:return e instanceof s.aM?(u=e.reqId,p=e.source,[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,r.remove([u])];case 1:return e.sent(),[2]}})})})]):[3,9];case 8:return v.sent(),this._broadcastRemoveUnsentEvent(u,p),[3,21];case 9:return e instanceof s.m?(l=e.polls,p=e.source,this._cacheContext.localCacheEnabled?[4,Promise.all(l.map(function(e){return e.messageId}).map(function(e){return n.get(e)}))]:[3,12]):[3,13];case 10:return(c=v.sent().filter(function(e){return e})).length>0&&l.forEach(function(e){var t=c.find(function(t){return t.messageId===e.messageId});t&&t.applyPoll(e)}),[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,n.upsert(c)];case 1:return[2,e.sent()]}})})})];case 11:v.sent(),v.label=12;case 12:return this._broadcastPollChangeLogEvent(l,p),[3,21];case 13:return e instanceof s.aL?(h=e.event,p=e.source,[4,n.get(h.messageId)]):[3,17];case 14:return(d=v.sent())&&d.isUserMessage()&&d.poll&&d.poll.applyPollUpdateEvent(h)?[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,n.upsert([d])];case 1:return[2,e.sent()]}})})})]:[3,16];case 15:v.sent(),v.label=16;case 16:return this._broadcastPollUpdateEvent(h,p),[3,21];case 17:return e instanceof s.aK?(_=e.event,p=e.source,[4,n.get(_.messageId)]):[3,21];case 18:return(f=v.sent())&&f.isUserMessage()&&f.poll&&f.poll.applyPollVoteEvent(_)?[4,(0,s.aJ)(function(){return(0,s.j)(m,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,n.upsert([f])];case 1:return[2,e.sent()]}})})})]:[3,20];case 19:v.sent(),v.label=20;case 20:this._broadcastPollVoteEvent(_,p),v.label=21;case 21:return[2]}})})})}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onUpdate(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onPollChangeLogUpdate(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onPollUpdate(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onPollVote(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onRemove(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var i=(0,s.z)(this._observers.values()),a=i.next();!a.done;a=i.next())a.value.onRemoveUnsent(e,t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),Y=function(e){function t(t){var n=t.userId,r=t.ts,i=t.token,a=t.filter,o=e.call(this)||this,u=(0,s.l)((0,s.l)({},D),a),l=u.customTypes,c=u.includeEmpty,h=u.includeFrozen;return o.method=s.A.GET,o.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/my_group_channels/changelogs"),o.params=(0,s.e)({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:r>0?r:null,token:i,custom_types:l,show_empty:c,show_frozen:h}),o}return(0,s._)(t,e),t}(s.b),W=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedChannels=n.updated.map(function(e){return new t9(t,e)}),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r}return(0,s._)(t,e),t}(s.c),Q=function(e){function t(t){var n=t.channelUrl,r=t.isInternalCall,i=e.call(this)||this;return i.method=s.A.GET,i.path="".concat(r?s.aO:s.aP,"/").concat(encodeURIComponent(n)),i.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},i}return(0,s._)(t,e),t}(s.b),J=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=null,r.channel=new t9(t,n),r}return(0,s._)(t,e),t}(s.c),Z=function(e){function t(t){var n=this,r=t.userId,i=t.token,a=t.limit,o=t.order,u=t.includeEmpty,l=t.myMemberStateFilter,c=t.superChannelFilter,h=t.publicChannelFilter,d=t.unreadChannelFilter,_=t.nicknameContainsFilter,p=t.nicknameStartsWithFilter,f=t.nicknameExactMatchFilter,m=t.channelNameContainsFilter,v=t.channelUrlsFilter,g=t.customTypesFilter,y=t.customTypeStartsWithFilter,E=t.hiddenChannelFilter,C=t.metadataOrderKeyFilter,b=t.metadataKey,N=t.metadataValues,M=t.metadataValueStartsWith,S=t.includeFrozen,T=t.includeMetaData,A=t.searchFilter,U=t.userIdsFilter;return(n=e.call(this)||this).method=s.A.GET,n.path="".concat(s.N,"/").concat(encodeURIComponent(r),"/my_group_channels"),n.params=(0,s.e)({token:i,limit:a,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:u,member_state_filter:l,super_mode:c,public_mode:h,unread_filter:d,members_nickname_contains:_,members_nickname_startswith:p,members_nickname:f,name_contains:m,channel_urls:v,custom_types:g,custom_type_startswith:y,hidden_mode:E,metadata_order_key:C,metadata_key:b,metadata_values:N,metadata_value_startswith:M,show_frozen:S,show_metadata:T}),A&&A.query&&A.fields&&(n.params.search_query=A.query,n.params.search_fields=A.fields),U&&U.userIds&&U.userIds.length>0&&(U.includeMode?(n.params.members_include_in=U.userIds,n.params.query_type=U.queryType.toUpperCase()):n.params.members_exactly_in=U.userIds),n}return(0,s._)(t,e),t}(s.b),X=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,i=n.channels,a=n.ts;return r.token=s,i&&i.length>0&&(r.channels=i.map(function(e){return e.ts=a,new t9(t,e)})),r.ts=null!=a?a:null,r}return(0,s._)(t,e),t}(s.c),$=function(e){function t(t){var n=t.userId,r=t.filter,i=e.call(this)||this,a=r.myMemberStateFilter;return i.method=s.A.GET,i.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/group_channel_count"),i.params={state:null!=a?a:h.ALL},i}return(0,s._)(t,e),t}(s.b),ee=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.groupChannelCount=n.group_channel_count,r}return(0,s._)(t,e),t}(s.c),et=function(e){function t(t){var n=t.userId,r=t.filter,i=e.call(this)||this,a=r.keys;return i.method=s.A.GET,i.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/unread_item_count"),i.params={item_keys:a},i}return(0,s._)(t,e),t}(s.b),en=function(e){function t(t,n){var r=e.call(this,t,n)||this;return"number"==typeof n[U.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(r.groupChannelUnreadMentionCount=n[U.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[U.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(r.groupChannelUnreadMessageCount=n[U.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[U.GROUP_CHANNEL_INVITATION_COUNT]&&(r.groupChannelInvitationCount=n[U.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[U.SUPER_UNREAD_MENTION_COUNT]&&(r.superGroupChannelUnreadMentionCount=n[U.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[U.SUPER_UNREAD_MESSAGE_COUNT]&&(r.superGroupChannelUnreadMessageCount=n[U.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[U.SUPER_INVITATION_COUNT]&&(r.superGroupChannelInvitationCount=n[U.SUPER_INVITATION_COUNT]),"number"==typeof n[U.NONSUPER_UNREAD_MENTION_COUNT]&&(r.nonSuperGroupChannelUnreadMentionCount=n[U.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[U.NONSUPER_UNREAD_MESSAGE_COUNT]&&(r.nonSuperGroupChannelUnreadMessageCount=n[U.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[U.NONSUPER_INVITATION_COUNT]&&(r.nonSuperGroupChannelInvitationCount=n[U.NONSUPER_INVITATION_COUNT]),r}return(0,s._)(t,e),t}(s.c),er=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=s.A.GET,r.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/unread_channel_count"),r}return(0,s._)(t,e),t}(s.b),es=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r}return(0,s._)(t,e),t}(s.c),ei=function(e){function t(t){var n=t.userId,r=t.filter,i=e.call(this)||this,a=r.channelCustomTypesFilter,o=r.superChannelFilter;return i.method=s.A.GET,i.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/unread_message_count"),i.params={super_mode:null!=o?o:d.ALL,custom_types:a},i}return(0,s._)(t,e),t}(s.b),ea=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r}return(0,s._)(t,e),t}(s.c),eo=function(e){function t(t){var n=t.channelUrl,r=t.scheduledStatus,i=t.messageTypeFilter,a=e.call(this)||this;return a.method=s.A.GET,a.path="".concat(s.aQ,"/count"),a.params={channel_url:n,status:el(r)},i&&(a.params.message_type=i),a}return(0,s._)(t,e),t}(s.b),eu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.count=n.count,r}return(0,s._)(t,e),t}(s.c),el=function(e){if(e){var t=[];return e.forEach(function(e){switch(e){case s.aI.PENDING:t.push(s.aR.PENDING);break;case s.aI.SENT:t.push(s.aR.IN_QUEUE),t.push(s.aR.SENT);break;case s.aI.CANCELED:t.push(s.aR.CANCELED);break;case s.aI.FAILED:t.push(s.aR.FAILED)}}),t}},ec=function(e){function t(t){var n=this,r=t.userId,i=t.channelUrl,a=t.coverUrl,o=t.coverImage,u=t.isDistinct,l=t.isSuper,c=t.isBroadcast,h=t.isPublic,d=t.isExclusive,_=t.isDiscoverable,p=t.isStrict,f=t.isEphemeral,m=t.accessCode,v=t.name,g=t.data,y=t.customType,E=t.messageSurvivalSeconds,C=t.invitedUserIds,b=t.operatorUserIds;return(n=e.call(this)||this).method=s.A.POST,n.path=s.aP,n.params=(0,s.e)({user_ids:(0,s.Z)([r],(0,s.Y)(null!=C?C:[]),!1).filter(function(e,t,n){return t===n.indexOf(e)}),channel_url:i,cover_url:a,cover_file:o,is_distinct:u,is_super:l,is_broadcast:c,is_exclusive:d,is_public:h,is_discoverable:_,strict:p,is_ephemeral:f,access_code:m,name:v,data:g,custom_type:y,operator_ids:b,message_survival_seconds:E}),n}return(0,s._)(t,e),t}(s.b),eh=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new t9(t,n),r.isCreated=n.is_created,r}return(0,s._)(t,e),t}(s.c),ed=function(e){function t(t){var n=t.userId,r=t.channelUrls,i=e.call(this)||this;return i.method=s.A.PUT,i.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),i.params={channel_urls:r},i}return(0,s._)(t,e),t}(s.b);eU=s.c,(0,s._)(function(){return null!==eU&&eU.apply(this,arguments)||this},eU);var e_=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.accessCode;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:i,access_code:a},n}return(0,s._)(t,e),t}(s.b),ep=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new t9(t,n),r}return(0,s._)(t,e),t}(s.c),ef=function(e){function t(t,n,r){var s=e.call(this,t,n,r)||this,i=r.data,a=i.member_count,o=i.joined_member_count,u=i.users,l=void 0===u?null:u;return s.memberCount=void 0===a?null:a,s.joinedMemberCount=void 0===o?null:o,s.members=Array.isArray(l)?l.map(function(e){return new g(t,e)}):[new g(t,r.data)],s}return(0,s._)(t,e),t}(o.C),em=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.shouldRemoveOperatorStatus;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:i,should_remove_operator_status:a},n}return(0,s._)(t,e),t}(s.b);eI=s.c,(0,s._)(function(e,t){return eI.call(this,e,t)||this},eI);var ev=function(e){function t(t,n,r){var s=e.call(this,t,n,r)||this,i=r.data,a=i.member_count,o=i.joined_member_count;return s.memberCount=void 0===a?null:a,s.joinedMemberCount=void 0===o?null:o,s.member=new g(s._iid,r.data),s}return(0,s._)(t,e),t}(o.C),eg=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userIds;return(n=e.call(this)||this).method=s.A.POST,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:i},n}return(0,s._)(t,e),t}(s.b),ey=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new t9(t,n),r}return(0,s._)(t,e),t}(s.c),eE=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,a=r.data,o=a.member_count,u=a.joined_member_count,l=a.inviter,c=void 0===l?null:l,h=a.invitees;return i.memberCount=void 0===o?null:o,i.joinedMemberCount=void 0===u?null:u,i.inviter=c?new s.U(t,c):null,i.invitees=(void 0===h?[]:h).map(function(e){return new g(t,e)}),i}return(0,s._)(t,e),t}(o.C),eC=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:i},n}return(0,s._)(t,e),t}(s.b),eb=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new t9(t,n),r.channel.myMemberState=l.NONE,r}return(0,s._)(t,e),t}(s.c),eN=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this,a=r.data,o=a.member_count,u=a.joined_member_count,l=a.inviter,c=void 0===l?null:l,h=a.invitee,d=void 0===h?null:h;return i.memberCount=void 0===o?null:o,i.joinedMemberCount=void 0===u?null:u,i.inviter=c?new s.U(t,c):null,i.invitee=d?new g(t,d):null,i}return(0,s._)(t,e),t}(o.C),eM=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return(0,s._)(t,e),t}(s.an),eS=function(e){function t(t,n,r){var s=e.call(this,t,"READ",r)||this;return s.readStatus=new y(t,r),s}return(0,s._)(t,e),t}(s.W),eT=function(e){function t(t){var n=t.channelUrl,r=t.userId,i=e.call(this)||this;return(i=e.call(this)||this).method=s.A.PUT,i.path="".concat(s.aP,"/").concat(encodeURIComponent(n),"/messages/mark_as_delivered"),i.params=(0,s.e)({userId:r}),i}return(0,s._)(t,e),t}(s.b);ew=s.c,(0,s._)(function(){return null!==ew&&ew.apply(this,arguments)||this},ew);var eA,eU,eI,ew,ek,eL=function(e){function t(t,n,r){var s=e.call(this,t,"DLVR",r)||this;return s.channelUrl=r.channel_url,s.deliveredStateUpdate=r.updated,s}return(0,s._)(t,e),t}(s.W),eD=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.hidePreviousMessages,o=t.allowAutoUnhide;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:i,hide_previous_messages:a,allow_auto_unhide:o},n}return(0,s._)(t,e),t}(s.b),eR=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return(0,s._)(t,e),t}(s.c),eP=function(e){function t(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.allowAutoUnhide=null,s.hidePreviousMessages=null,s.messageOffsetTimestamp=null,r.data&&(s.allowAutoUnhide=r.data.allow_auto_unhide,s.hidePreviousMessages=r.data.hide_previous_messages),s.messageOffsetTimestamp=r.ts_message_offset,s}return(0,s._)(t,e),t}(s.W),eO=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return(0,s._)(t,e),t}(s.an),eV=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new s.U(t,r.data),i}return(0,s._)(t,e),t}(s.W),eF=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return(0,s._)(t,e),t}(s.an),ex=function(e){function t(t,n,r){var i=e.call(this,t,"SYEV",r)||this;return i.user=new s.U(t,r.data),i}return(0,s._)(t,e),t}(s.W),eH=function(e){function t(t){var n=t.channelUrl,r=t.messageId;return e.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return(0,s._)(t,e),t}(s.an),ej=function(e){function t(t,n,r){var a=e.call(this,t,"PEDI",r)||this;return a.event=null,a.status=null,a.channelUrl=null,a.channelType=null,a.event=new i.P(t,r),a.status=(0,s.aS)(r.poll.status)||r.poll.status,a.channelUrl=r.channel_url,a.channelType=r.channel_type,a}return(0,s._)(t,e),t}(s.W),eG=function(e){function t(t,n,r){var s=e.call(this,t,"VOTE",r)||this;return s.event=null,s.channelUrl=null,s.channelType=null,s.event=new i.b(r),s.channelUrl=r.channel_url,s.channelType=r.channel_type,s}return(0,s._)(t,e),t}(s.W),eq=function(e){function t(t,n){var r,s,a,o,u,l,f,v,g,y,E,C,b,N,M,S,T,A,U,I,w,k,L=this;return(L=e.call(this,t,n)||this).includeEmpty=!1,L.includeFrozen=!0,L.includeMetaData=!0,L.channelUrlsFilter=null,L.customTypesFilter=null,L.customTypeStartsWithFilter=null,L.nicknameContainsFilter=null,L.nicknameStartsWithFilter=null,L.nicknameExactMatchFilter=null,L.channelNameContainsFilter="",L.myMemberStateFilter=h.ALL,L.unreadChannelFilter=_.ALL,L.superChannelFilter=d.ALL,L.publicChannelFilter=c.ALL,L.hiddenChannelFilter=p.UNHIDDEN,L.searchFilter={fields:[],query:null},L.userIdsFilter={userIds:[],includeMode:!0,queryType:m.AND},L.metadataKey=null,L.metadataValues=null,L.metadataOrderKeyFilter=null,L.metadataValueStartsWith=null,L.order=i.G.LATEST_LAST_MESSAGE,L.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,L.includeFrozen=null===(s=n.includeFrozen)||void 0===s||s,L.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,L.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,L.customTypesFilter=null!==(u=n.customTypesFilter)&&void 0!==u?u:null,L.customTypeStartsWithFilter=null!==(l=n.customTypeStartsWithFilter)&&void 0!==l?l:"",L.nicknameContainsFilter=null!==(f=n.nicknameContainsFilter)&&void 0!==f?f:null,L.nicknameStartsWithFilter=null!==(v=n.nicknameStartsWithFilter)&&void 0!==v?v:null,L.nicknameExactMatchFilter=null!==(g=n.nicknameExactMatchFilter)&&void 0!==g?g:null,L.channelNameContainsFilter=null!==(y=n.channelNameContainsFilter)&&void 0!==y?y:"",L.myMemberStateFilter=null!==(E=n.myMemberStateFilter)&&void 0!==E?E:h.ALL,L.unreadChannelFilter=null!==(C=n.unreadChannelFilter)&&void 0!==C?C:_.ALL,L.superChannelFilter=null!==(b=n.superChannelFilter)&&void 0!==b?b:d.ALL,L.publicChannelFilter=null!==(N=n.publicChannelFilter)&&void 0!==N?N:c.ALL,L.hiddenChannelFilter=null!==(M=n.hiddenChannelFilter)&&void 0!==M?M:p.UNHIDDEN,L.searchFilter=null!==(S=n.searchFilter)&&void 0!==S?S:{fields:[],query:null},L.userIdsFilter=null!==(T=n.userIdsFilter)&&void 0!==T?T:{userIds:[],includeMode:!0,queryType:m.AND},L.metadataKey=null!==(A=n.metadataKey)&&void 0!==A?A:null,L.metadataValues=null!==(U=n.metadataValues)&&void 0!==U?U:null,L.metadataOrderKeyFilter=null!==(I=n.metadataOrderKeyFilter)&&void 0!==I?I:null,L.metadataValueStartsWith=null!==(w=n.metadataValueStartsWith)&&void 0!==w?w:null,L.order=null!==(k=n.order)&&void 0!==k?k:i.G.LATEST_LAST_MESSAGE,L}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.i)("boolean",this.includeEmpty)&&(0,s.i)("boolean",this.includeFrozen)&&(0,s.i)("boolean",this.includeMetaData)&&(0,s.i)("string",this.channelNameContainsFilter)&&(0,s.T)("string",this.channelUrlsFilter,!0)&&(0,s.T)("string",this.customTypesFilter,!0)&&(0,s.i)("string",this.customTypeStartsWithFilter)&&(0,s.i)("string",this.nicknameContainsFilter,!0)&&(0,s.i)("string",this.nicknameStartsWithFilter,!0)&&(0,s.i)("string",this.nicknameExactMatchFilter,!0)&&(0,s.h)(h,this.myMemberStateFilter)&&(0,s.h)(d,this.superChannelFilter)&&(0,s.h)(c,this.publicChannelFilter)&&(0,s.h)(_,this.unreadChannelFilter)&&(0,s.h)(p,this.hiddenChannelFilter)&&(0,s.T)(v,this.searchFilter.fields)&&(0,s.i)("string",this.searchFilter.query,!0)&&(0,s.T)("string",this.userIdsFilter.userIds)&&(0,s.i)("boolean",this.userIdsFilter.includeMode)&&(0,s.h)(m,this.userIdsFilter.queryType)&&(0,s.h)(i.G,this.order)&&(0,s.i)("string",this.metadataOrderKeyFilter,!0)&&(0,s.i)("string",this.metadataKey,!0)&&(0,s.T)("string",this.metadataValues,!0)&&(0,s.i)("string",this.metadataValueStartsWith,!0)},t.prototype.serialize=function(){return(0,s.aT)(this)},t.prototype.next=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,eB.of(this._iid).getMyGroupChannels(this._token,this,this.limit)]):[3,2]:[3,5];case 1:return t=(e=r.sent()).channels,n=e.token,this._token=n,this._hasNext=!!n,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.X),ez=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,r=e.bottom;this.top=n,this.bottom=void 0===r?0:r}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every(function(t){return e.top<=t&&t<=e.bottom})},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,(0,s.Z)([this.top],(0,s.Y)(e),!1)),this.bottom=Math.max.apply(Math,(0,s.Z)([this.bottom],(0,s.Y)(e),!1))},e}(),eK={},eB=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,a=t.dispatcher,o=t.sessionManager,u=t.requestQueue,l=t.logger,c=this;this._leftChannels=new Map,this._markAsReadAllLastSentAt=0,this._iid=e,this._sdkState=n,this._sessionManager=o,this._requestQueue=u,this._dispatcher=a,this._logger=l,this._groupChannelHandlers=new Map,this._groupChannelCache=new w(this._iid,{sdkState:n,cacheContext:r}),this._unsentMessageCache=new i.U(this._iid,{sdkState:n,cacheContext:r}),this._messageCache=new i.M(this._iid,{sdkState:n,cacheContext:r,unsentMessageCache:this._unsentMessageCache}),this._groupChannelBroadcast=new K({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:a}),this._messageBroadcast=new B({cacheContext:r,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:a,logger:l}),setInterval(function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(c._dispatcher.dispatch(new q({channels:[e],source:F.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),c._groupChannelHandlers.forEach(function(t){t.onTypingStatusUpdated(e)}))};try{for(var r=(0,s.z)(c._groupChannelCache.channels),i=r.next();!i.done;i=r.next())n(i.value)}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},1e3),this._dispatcher.on(function(e){e instanceof s.W?c._handleEvent(e):e instanceof i.A&&(0,s.j)(c,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:return t=e.message,[4,this.getChannel(t.channelUrl,!0)];case 1:return n=r.sent(),t instanceof s.x?n._autoResendUserMessage(t):t instanceof s.F&&n._autoResendFileMessage(t),[2]}})})}),eK[e]=this}return e.of=function(e){return eK[e]},Object.defineProperty(e.prototype,"handlers",{get:function(){return(0,s.Z)([],(0,s.Y)(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),e.prototype.buildGroupChannelFromSerializedData=function(e){var t=(0,s.a5)(e);return new t9(this._iid,t9.payloadify(t))},e.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=(0,s.a5)(e);return new eq(this._iid,t)},e.prototype.buildMemberFromSerializedData=function(e){var t=(0,s.a5)(e);return new g(this._iid,g.payloadify(t))},e.prototype.getChannelFromCache=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,t.sent()]}})})},e.prototype.getChannelsFromCache=function(e,t,n){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(r){switch(r.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n})];case 1:return[2,r.sent()]}})})},e.prototype._handleEvent=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,u,c,h,d,_,p,f,m,v,g,y,E,C,b,N,M,S,T,A,U,I,w,k,L,D,R,P,O,V,x,H,j,G,K,B,Y,W,Q,J,Z,X,$,ee,et,en,er,es,ei,ea,eo,eu,el,ec,eh,ed,e_,ep,em,eg,ey,eC,eb,eM,eT,eA,eU,eI,ew,ek,eD,eR,eO,eF,eq,ez,eK,eB,eY,eW,eQ,eJ,eZ,eX,e$,e0,e1,e2,e3,e4,e6,e7,e5,e8,e9,te,tt,tn,tr,ts,ti,ta,to,tu,tl,tc,th,td,t_,tp,tf,tm,tv,tg,ty,tE,tC,tb,tN,tM,tS,tT,tA,tU,tI,tw,tk,tL=this;return(0,s.k)(this,function(tD){switch(tD.label){case 0:switch(tD.trys.push([0,76,,77]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"PEDI":return[3,32];case"VOTE":return[3,34];case"SYEV":return[3,36];case"USEV":return[3,74]}return[3,75];case 1:return _=null,"MESG"===e.code?_=e.as(a.t):"FILE"===e.code?_=e.as(s.aU):"ADMM"!==e.code&&"BRDM"!=e.code||(_=e.as(o.A)),_?(t=_.message,n=_.isMentioned,r=_.forceUpdateLastMessage,t.channelType!==s.C.GROUP?[3,3]:((0,s.aJ)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new eH(t),this._requestQueue.send(e),[2]})})}),U=this._groupChannelCache.isCachedInMemory(t.channelUrl),v=t instanceof s.w&&t.sender.userId===this._sdkState.userId,[4,this.getChannel(t.channelUrl,!0)])):[3,3];case 2:if((u=tD.sent()).hiddenState=t3.UNHIDDEN,t instanceof s.w){c=s.V.of(this._iid).useMemberInfoInMessage;try{for(d=(h=(0,s.z)(u.members)).next();!d.done;d=h.next())if((e$=d.value).userId===t.sender.userId){c||(t.sender.nickname=e$.nickname,t.sender.plainProfileUrl=e$.plainProfileUrl,t.sender.metaData=e$.metaData,t.sender.isBlockedByMe=e$.isBlockedByMe);break}}catch(e){tb={error:e}}finally{try{d&&!d.done&&(tN=h.return)&&tN.call(h)}finally{if(tb)throw tb.error}}!c&&n&&t.mentionedUsers.forEach(function(e){var t,n;try{for(var r=(0,s.z)(u.members),i=r.next();!i.done;i=r.next()){var a=i.value;if(e.userId===a.userId){e.nickname=a.nickname,e.plainProfileUrl=a.plainProfileUrl,e.metaData=a.metaData;break}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}),v&&(y=this._sessionManager.currentUser)&&(y.nickname=t.sender.nickname,y.plainProfileUrl=t.sender.plainProfileUrl,y.metaData=t.sender.metaData)}t.silent&&!v||(u.isEphemeral||U)&&((!u.lastMessage||u.lastMessage.createdAt<t.createdAt)&&(u.lastMessage=t),v||u._updateUnreadCount(u.unreadMessageCount+1,u.unreadMentionCount+(n?1:0))),r&&(!u.lastMessage||u.lastMessage.createdAt<t.createdAt)&&(u.lastMessage=t),this._dispatcher.dispatch(new q({channels:[u],source:F.EVENT_MESSAGE_RECEIVED})),t.silent&&!v||(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(u)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),this._dispatcher.dispatch(new s.L({messages:[t],source:s.M.EVENT_MESSAGE_RECEIVED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,r,i,a,o;return(0,s.k)(this,function(l){try{for(r=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!r.done;r=e.next())(i=r.value).onMessageReceived(u,t),n&&i.onMentionReceived(u,t)}catch(e){a={error:e}}finally{try{r&&!r.done&&(o=e.return)&&o.call(e)}finally{if(a)throw a.error}}return[2]})})}),tD.label=3;case 3:return[3,75];case 4:return _=null,"MEDI"===e.code?_=e.as(a.q):"FEDI"===e.code?_=e.as(a.r):"AEDI"===e.code&&(_=e.as(o.U)),_?(p=_.message,f=_.mentionCountChange,p.channelType!==s.C.GROUP?[3,6]:(U=this._groupChannelCache.isCachedInMemory(p.channelUrl),[4,this.getChannel(p.channelUrl,!0)])):[3,6];case 5:m=tD.sent(),v=p instanceof s.w&&p.sender.userId===this._sdkState.userId,g=!1,v?(y=this._sessionManager.currentUser)&&(y.nickname=p.sender.nickname,y.plainProfileUrl=p.sender.plainProfileUrl,y.metaData=p.sender.metaData):m.isReadMessage(p)||0!==f&&!p.silent&&U&&(m._updateUnreadCount(m.unreadMessageCount,m.unreadMentionCount+f),g=!0),!m.lastMessage||m.lastMessage.createdAt<p.createdAt?(m.lastMessage=p,g=!0):m.lastMessage.isIdentical(p)&&(U?m.lastMessage.updatedAt<p.updatedAt&&(m.lastMessage=p,g=!0):g=!0),g&&(this._dispatcher.dispatch(new q({channels:[m],source:F.EVENT_MESSAGE_UPDATED})),p.silent&&!v||(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(m)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})),this._dispatcher.dispatch(new s.L({messages:[p],source:s.M.EVENT_MESSAGE_UPDATED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())(n=t.value).onMessageUpdated(m,p),0!==f&&n.onMentionReceived(m,p)}catch(e){r={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}}return[2]})})}),tD.label=6;case 6:return[3,75];case 7:return $=(E=e.as(a.D)).channelUrl,ee=E.channelType,C=E.messageId,ee!==s.C.GROUP?[3,9]:[4,this.getChannel($,!0)];case 8:b=tD.sent(),this._dispatcher.dispatch(new s.aN({messageIds:[C],source:s.M.EVENT_MESSAGE_DELETED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onMessageDeleted(b,C)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),tD.label=9;case 9:return[3,75];case 10:return(N=e.as(eS).readStatus).channelType!==s.C.GROUP?[3,12]:(U=this._groupChannelCache.isCachedInMemory(N.channelUrl),[4,this.getChannel(N.channelUrl,!0)]);case 11:M=tD.sent(),U&&M._updateUnreadMemberState(N.reader.userId,N.readAt),N.reader.userId===this._sdkState.userId?U?(M.unreadMessageCount>0||M.unreadMentionCount>0)&&(M._updateUnreadCount(0,0),this._dispatcher.dispatch(new q({channels:[M],source:F.EVENT_CHANNEL_READ})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(M)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})):0!==M.unreadMessageCount&&0!==M.unreadMentionCount||(this._dispatcher.dispatch(new q({channels:[M],source:F.EVENT_CHANNEL_READ})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(M)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})):(this._dispatcher.dispatch(new q({channels:[M],source:F.EVENT_CHANNEL_READ})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onUnreadMemberStatusUpdated(M)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})),tD.label=12;case 12:return[3,75];case 13:return $=(S=e.as(eL)).channelUrl,A=void 0===(T=S.deliveredStateUpdate)?{}:T,U=this._groupChannelCache.isCachedInMemory($),[4,this.getChannel($,!0)];case 14:if(I=tD.sent(),U)for(w in A)I._updateUndeliveredMemberState(w,A[w]);return this._dispatcher.dispatch(new q({channels:[I],source:F.EVENT_CHANNEL_DELIVERED})),Object.keys(A).some(function(e){return e!==tL._sdkState.userId})&&(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onUndeliveredMemberStatusUpdated(I)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),[3,75];case 15:return $=(k=e.as(o.R)).channelUrl,ee=k.channelType,L=k.event,ee!==s.C.GROUP?[3,18]:[4,this.getChannel($,!0)];case 16:return D=tD.sent(),[4,this.getMessageFromCache(L.messageId)];case 17:(O=tD.sent())&&(O.applyReactionEvent(L),this._dispatcher.dispatch(new s.L({messages:[O],source:s.M.EVENT_MESSAGE_REACTION_UPDATED}))),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onReactionUpdated(D,L)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),tD.label=18;case 18:return[3,75];case 19:return(R=e.as(o.T).event).channelType!==s.C.GROUP?[3,22]:[4,this.getChannel(R.channelUrl,!0)];case 20:return P=tD.sent(),[4,this.getMessageFromCache(R.targetMessageId)];case 21:(O=tD.sent())&&(O.applyThreadInfoUpdateEvent(R),this._dispatcher.dispatch(new s.L({messages:[O],source:s.M.EVENT_MESSAGE_THREADINFO_UPDATED}))),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onThreadInfoUpdated(P,R)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),tD.label=22;case 22:return[3,75];case 23:V=e.as(o.M).groupChannelMemberCounts,x=[],tD.label=24;case 24:tD.trys.push([24,29,30,31]),j=(H=(0,s.z)(V)).next(),tD.label=25;case 25:return j.done?[3,28]:($=(G=j.value).channelUrl,eO=G.memberCount,eF=G.joinedMemberCount,K=G.updatedAt,[4,this.getChannelFromCache($)]);case 26:(B=tD.sent())&&B._setLatestMemberCount(eO,eF,K)&&x.push(B),tD.label=27;case 27:return j=H.next(),[3,25];case 28:return[3,31];case 29:return tM={error:tD.sent()},[3,31];case 30:try{j&&!j.done&&(tS=H.return)&&tS.call(H)}finally{if(tM)throw tM.error}return[7];case 31:return x.length>0&&(this._dispatcher.dispatch(new q({channels:x,source:F.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelMemberCountChanged(x)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})),[3,75];case 32:return W=(Y=e.as(ej)).event,Q=Y.status,$=Y.channelUrl,ee=Y.channelType,$&&ee?[4,this.getChannel($,!0)]:[3,75];case 33:return J=tD.sent(),this._dispatcher.dispatch(new s.aL({event:W,source:s.M.EVENT_POLL_UPDATED})),(0,s.a6)(Q===s.aV?function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onPollDeleted(J,W.pollId)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}:function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onPollUpdated(J,W)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),[3,75];case 34:return X=(Z=e.as(eG)).event,$=Z.channelUrl,ee=Z.channelType,$&&ee?[4,this.getChannel($,!0)]:[3,75];case 35:return et=tD.sent(),this._dispatcher.dispatch(new s.aK({event:X,source:s.M.EVENT_POLL_VOTED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){try{for(t=(e=(0,s.z)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onPollVoted(et,X)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),[3,75];case 36:if(!(en=e.as(o.C).event).isGroupChannelEvent)return[3,73];switch(en.category){case o.a.CHANNEL_JOIN:return[3,37];case o.a.CHANNEL_LEAVE:return[3,39];case o.a.CHANNEL_OPERATOR_UPDATE:return[3,43];case o.a.CHANNEL_INVITE:return[3,45];case o.a.CHANNEL_DECLINE_INVITE:return[3,47];case o.a.TYPING_START:case o.a.TYPING_END:return[3,49];case o.a.USER_CHANNEL_MUTE:case o.a.USER_CHANNEL_UNMUTE:return[3,51];case o.a.USER_CHANNEL_BAN:return[3,53];case o.a.USER_CHANNEL_UNBAN:return[3,57];case o.a.CHANNEL_FREEZE:case o.a.CHANNEL_UNFREEZE:return[3,59];case o.a.CHANNEL_HIDE:return[3,61];case o.a.CHANNEL_UNHIDE:return[3,63];case o.a.CHANNEL_DELETED:return[3,65];case o.a.CHANNEL_PROP_CHANGED:return[3,67];case o.a.CHANNEL_META_DATA_CHANGED:return[3,69];case o.a.CHANNEL_META_COUNTERS_CHANGED:return[3,71]}return[3,73];case 37:case 40:return[4,this.getChannel(en.channelUrl,!0)];case 38:return er=tD.sent(),ei=(es=e.as(ef)).memberCount,ea=es.joinedMemberCount,eo=es.members,eu=!1,eo.forEach(function(e){er.isExclusive||er.isSuper||er.isBroadcast?eu=eu||er._setLatestMemberCount(ei,ea,en.ts):(e.state=l.JOINED,er.addMember(e,en.ts),tL._updateJoinedMemberCount(er)),e.userId===tL._sdkState.userId&&(er.myMemberState=l.JOINED)}),this._dispatcher.dispatch(new q({channels:[er],source:F.EVENT_CHANNEL_JOINED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){var t,n;try{for(var r=(0,s.z)(eo),i=r.next();!i.done;i=r.next()){var a=i.value;e.onUserJoined(er,a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}er.isBroadcast&&eu&&e.onChannelMemberCountChanged([er])}),[2]})})}),[3,73];case 39:return(e0=this._leftChannels.get(en.channelUrl))?(ec=e0.channel,[3,42]):[3,40];case 41:ec=tD.sent(),tD.label=42;case 42:return el=ec,eO=(eh=e.as(ev)).memberCount,eF=eh.joinedMemberCount,ed=eh.member,e_=!1,ep=s.V.of(this._iid).appInfo,el.isExclusive||el.isSuper||el.isBroadcast?e_=el._setLatestMemberCount(eO,eF,en.ts):(ep.enabledChannelMemberShipHistory?(el.members.find(function(e){return e.userId===ed.userId}).state=l.LEFT,el.memberCount=eO):el.removeMember(ed),this._updateJoinedMemberCount(el)),ed.userId===this._sdkState.userId?(el.myMemberState=l.NONE,el.invitedAt=0,el.joinedAt=0,el._updateUnreadCount(0,0),el.isPublic?this._dispatcher.dispatch(new q({channels:[el],source:F.EVENT_CHANNEL_LEFT})):(this._markAsLeave(el),this._dispatcher.dispatch(new z({channelUrls:[el.url],source:F.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new q({channels:[el],source:F.EVENT_CHANNEL_LEFT})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserLeft(el,ed),el.isBroadcast&&e_&&e.onChannelMemberCountChanged([el])}),[2]})})}),[3,73];case 43:case 45:case 47:case 49:case 51:case 54:return[4,this.getChannel(en.channelUrl,!0)];case 44:em=tD.sent(),ey=(eg=e.as(o.O).operators).map(function(e){return e.userId});try{for(eb=(eC=(0,s.z)(em.members)).next();!eb.done;eb=eC.next())(e$=eb.value).role=ey.includes(e$.userId)?s.af.OPERATOR:s.af.NONE}catch(e){tT={error:e}}finally{try{eb&&!eb.done&&(tA=eC.return)&&tA.call(eC)}finally{if(tT)throw tT.error}}return em.myRole=ey.includes(this._sdkState.userId)?s.af.OPERATOR:s.af.NONE,this._dispatcher.dispatch(new q({channels:[em],source:F.EVENT_CHANNEL_OPERATOR_UPDATED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onOperatorUpdated(em,eg)}),[2]})})}),[3,73];case 46:eM=tD.sent(),eO=(eT=e.as(eE)).memberCount,eF=eT.joinedMemberCount,eA=eT.inviter,(eU=eT.invitees).forEach(function(e){return e.state=l.INVITED});try{for(ew=(eI=(0,s.z)(eU)).next();!ew.done;ew=eI.next())ek=ew.value,eM.isExclusive||eM.isSuper||eM.isBroadcast?eM._setLatestMemberCount(eO,eF,en.ts):eM.addMember(ek,en.ts),this._sdkState.userId===ek.userId&&(eM.hiddenState=t3.UNHIDDEN,eM.myMemberState!==l.JOINED&&(eM.myMemberState=l.INVITED),eM.invitedAt=en.ts)}catch(e){tU={error:e}}finally{try{ew&&!ew.done&&(tI=eI.return)&&tI.call(eI)}finally{if(tU)throw tU.error}}return this._dispatcher.dispatch(new q({channels:[eM],source:F.EVENT_CHANNEL_INVITED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserReceivedInvitation(eM,eA,eU)}),[2]})})}),[3,73];case 48:return eD=tD.sent(),eO=(eR=e.as(eN)).memberCount,eF=eR.joinedMemberCount,eq=eR.inviter,ez=eR.invitee,eD.isExclusive||eD.isSuper||eD.isBroadcast?eD._setLatestMemberCount(eO,eF,en.ts):eD.removeMember(ez),this._sdkState.userId===ez.userId?(eD.invitedAt=0,eD.myMemberState=l.NONE,eD.isPublic?this._dispatcher.dispatch(new q({channels:[eD],source:F.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new z({channelUrls:[eD.url],source:F.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new q({channels:[eD],source:F.EVENT_CHANNEL_DECLINED_INVITE})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserDeclinedInvitation(eD,eq,ez)}),[2]})})}),[3,73];case 50:return eK=tD.sent(),eB=en.category===o.a.TYPING_START,eY=e.as(eB?eV:ex).user,eK._updateTypingStatus(eY,eB?en.ts:0),this._dispatcher.dispatch(new q({channels:[eK],source:F.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onTypingStatusUpdated(eK)}),[2]})})}),[3,73];case 52:eW=tD.sent(),eQ=en.category===o.a.USER_CHANNEL_MUTE,(eJ=e.as(eQ?a.o:a.p).user).userId===this._sdkState.userId&&(eW.myMutedState=eQ?t2.MUTED:t2.UNMUTED);try{for(eX=(eZ=(0,s.z)(eW.members)).next();!eX.done;eX=eZ.next())if((e$=eX.value).userId===eJ.userId){e$.isMuted=eQ;break}}catch(e){tw={error:e}}finally{try{eX&&!eX.done&&(tk=eZ.return)&&tk.call(eZ)}finally{if(tw)throw tw.error}}return this._dispatcher.dispatch(new q({channels:[eW],source:eQ?F.EVENT_CHANNEL_MUTED:F.EVENT_CHANNEL_UNMUTED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){eQ?e.onUserMuted(eW,eJ):e.onUserUnmuted(eW,eJ)}),[2]})})}),[3,73];case 53:return(e0=this._leftChannels.get(en.channelUrl))?(e2=e0.channel,[3,56]):[3,54];case 55:e2=tD.sent(),tD.label=56;case 56:return e1=e2,this._markAsLeave(e1),e3=e.as(a.n).user,(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserBanned(e1,e3)}),[2]})})}),[3,73];case 57:case 59:case 61:case 63:case 65:case 69:case 71:return[4,this.getChannel(en.channelUrl,!0)];case 58:return e4=tD.sent(),e6=e.as(a.m).user,(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserUnbanned(e4,e6)}),[2]})})}),[3,73];case 60:return e7=tD.sent(),e5=e.as(a.l).freeze,e7.isFrozen=e5,this._dispatcher.dispatch(new q({channels:[e7],source:e5?F.EVENT_CHANNEL_FROZEN:F.EVENT_CHANNEL_UNFROZEN})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e5?e.onChannelFrozen(e7):e.onChannelUnfrozen(e7)}),[2]})})}),[3,73];case 62:return e8=tD.sent(),te=(e9=e.as(eP)).allowAutoUnhide,tt=e9.hidePreviousMessages,tn=e9.messageOffsetTimestamp,null!==te&&(e8.hiddenState=te?t3.HIDDEN_ALLOW_AUTO_UNHIDE:t3.HIDDEN_PREVENT_AUTO_UNHIDE),null!==tt&&tt&&e8._updateUnreadCount(0,0),null!==tn&&(e8.messageOffsetTimestamp=tn),this._dispatcher.dispatch(new q({channels:[e8],source:F.EVENT_CHANNEL_HIDDEN})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelHidden(e8)}),[2]})})}),[3,73];case 64:return(tr=tD.sent()).hiddenState=t3.UNHIDDEN,this._dispatcher.dispatch(new q({channels:[tr],source:F.EVENT_CHANNEL_UNHIDDEN})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelChanged(tr)}),[2]})})}),[3,73];case 66:return ts=tD.sent(),this._dispatcher.dispatch(new z({channelUrls:[en.channelUrl],source:F.EVENT_CHANNEL_DELETED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelDeleted(ts.url,ts.channelType)}),[2]})})}),[3,73];case 67:return[4,this.getChannelWithoutCache(en.channelUrl,!0)];case 68:return ti=tD.sent(),this._dispatcher.dispatch(new q({channels:[ti],source:F.EVENT_CHANNEL_UPDATED})),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelChanged(ti)}),[2]})})}),[3,73];case 70:return ta=tD.sent(),tu=(to=e.as(a.k)).created,tl=to.updated,tc=to.deleted,tu&&ta._upsertCachedMetaData(tu,en.ts),tl&&ta._upsertCachedMetaData(tl,en.ts),tc&&ta._removeFromCachedMetaData(tc,en.ts),(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){tu&&e.onMetaDataCreated(ta,tu),tl&&e.onMetaDataUpdated(ta,tl),tc&&e.onMetaDataDeleted(ta,tc)}),[2]})})}),[3,73];case 72:return th=tD.sent(),t_=(td=e.as(a.j)).created,tp=td.updated,tf=td.deleted,(0,s.a6)(function(){return(0,s.j)(tL,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._groupChannelHandlers.forEach(function(e){t_&&e.onMetaCounterCreated(th,t_),tp&&e.onMetaCounterUpdated(th,tp),tf&&e.onMetaCounterDeleted(th,tf)}),[2]})})}),[3,73];case 73:return[3,75];case 74:switch((tm=e.as(i.c).event).category){case i.d.USER_BLOCK:ty=(tv=i.e.getDataAsUserBlockEvent(this._iid,tm)).blocker,tE=tv.blockee,this._groupChannelCache.block(ty.userId,tE.userId);break;case i.d.USER_UNBLOCK:ty=(tg=i.e.getDataAsUserBlockEvent(this._iid,tm)).blocker,tE=tg.blockee,this._groupChannelCache.unblock(ty.userId,tE.userId)}return[3,75];case 75:return[3,77];case 76:if(tC=tD.sent(),(0,s.ax)(tC))throw tC;return[3,77];case 77:return[2]}})})},e.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout(function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)},1e4)},e.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},e.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},e.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},e.prototype.subscribeGroupChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},e.prototype.unsubscribeGroupChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},e.prototype.subscribeMessageEvent=function(e,t){this._messageBroadcast.subscribe(e,t)},e.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},e.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter(function(e){return e.state===l.JOINED}).length},e.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),(0,s.j)(this,void 0,void 0,function(){var n;return(0,s.k)(this,function(r){switch(r.label){case 0:(0,s.u)((0,s.i)("string",e)).throw(s.S.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}})})},e.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),(0,s.j)(this,void 0,void 0,function(){var n,r,i,a;return(0,s.k)(this,function(o){switch(o.label){case 0:return(0,s.u)((0,s.i)("string",e)).throw(s.S.invalidParameters),n=new Q({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(i=(r=o.sent().as(J).channel).unreadMessageCount,a=r.unreadMentionCount,r.myCountPreference){case t1.UNREAD_MESSAGE_COUNT_ONLY:a=0;break;case t1.UNREAD_MENTION_COUNT_ONLY:i=0;break;case t1.OFF:i=0,a=0}return r._updateUnreadCount(i,a),[4,this._groupChannelCache.upsert([r])];case 2:return o.sent(),[2,r]}})})},e.prototype.getMyGroupChannels=function(e,t,n,r){return void 0===r&&(r=F.REQUEST_CHANNEL),(0,s.j)(this,void 0,void 0,function(){var i,a,o,u;return(0,s.k)(this,function(l){switch(l.label){case 0:return i=new Z((0,s.l)((0,s.l)({},t),{userId:this._sdkState.userId,token:e,limit:n})),[4,this._requestQueue.send(i)];case 1:return o=(a=l.sent().as(X)).channels,u=a.token,this._dispatcher.dispatch(new q({channels:o,source:r})),[2,{channels:o,token:u}]}})})},e.prototype.getMessageFromCache=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,t.sent()]}})})},e.prototype.getMessagesFromCache=function(e,t,n,r,a){return void 0===a&&(a=i.f),(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:a,filter:r,backward:"next"===n})];case 1:return[2,s.sent()]}})})},e.prototype.getPollMessagesFromCache=function(e,t,n,r){return void 0===r&&(r=i.f),(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:n,backward:!1,isPollOnly:!0})];case 1:return[2,s.sent()]}})})},e.prototype.getUnsentMessagesFromCache=function(e,t){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t})];case 1:return[2,n.sent()]}})})},e.prototype.removeFailedMessageFromCache=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}})})},e.prototype.getCachedMessageCountBetween=function(e,t,n,r){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(s){switch(s.label){case 0:return[4,this._messageCache.countBetween(e,t,new ez({top:n,bottom:r}))];case 1:return[2,s.sent()]}})})},e.prototype.getMyGroupChannelChangeLogs=function(e,t,n){return void 0===n&&(n=F.REQUEST_CHANNEL_CHANGELOGS),(0,s.j)(this,void 0,void 0,function(){var r,i,a,o,u;return(0,s.k)(this,function(l){switch(l.label){case 0:return r=(0,s.l)((0,s.l)({},D),t),(0,s.u)(((0,s.i)("string",e)||(0,s.i)("number",e))&&R(r)).throw(s.S.invalidParameters),i=new Y((0,s.e)({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:r})),[4,this._requestQueue.send(i)];case 1:return o=(a=l.sent().as(W)).updatedChannels,u=a.deletedChannelUrls,o.length>0&&this._dispatcher.dispatch(new q({channels:o,source:n})),u.length>0&&this._dispatcher.dispatch(new z({channelUrls:u,source:n})),[2,a]}})})},e.prototype.getGroupChannelCount=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:return t=(0,s.l)((0,s.l)({},P),e),(0,s.u)(O(t)).throw(s.S.invalidParameters),n=new $({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return[2,r.sent().as(ee).groupChannelCount]}})})},e.prototype.getUnreadItemCount=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a;return(0,s.k)(this,function(o){switch(o.label){case 0:return t=(0,s.l)((0,s.l)({},x),e),(0,s.u)((0,s.T)(U,t.keys)).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).sdkState,i=n.requestQueue,a=new et({userId:r.userId,filter:t}),[4,i.send(a)];case 1:return[2,o.sent().as(en)]}})})},e.prototype.getTotalUnreadChannelCount=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new er({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(es).unreadCount]}})})},e.prototype.getTotalUnreadMessageCount=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a;return(0,s.k)(this,function(o){switch(o.label){case 0:return t=(0,s.l)((0,s.l)({},H),e),(0,s.u)((0,s.T)("string",t.channelCustomTypesFilter,!0)&&(0,s.h)(d,t.superChannelFilter)).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).sdkState,i=n.requestQueue,a=new ei({userId:r.userId,filter:t}),[4,i.send(a)];case 1:return[2,o.sent().as(ea).unreadCount]}})})},e.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),(0,s.j)(this,void 0,void 0,function(){var t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=(0,s.l)((0,s.l)({},j),e),(0,s.u)((0,s.i)("string",t.channelUrl,!0)&&(0,s.T)(s.aI,t.scheduledStatus,!0)&&(0,s.h)(s.s,t.messageTypeFilter)).throw(s.S.invalidParameters),n=s.V.of(this._iid).requestQueue,r=new eo(t),[4,n.send(r)];case 1:return[2,i.sent().as(eu).count]}})})},e.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=s.V.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},e.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=s.V.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e},e.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=s.V.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},e.prototype.createChannel=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=(0,s.l)((0,s.l)({},k),e),(0,s.u)(L(t)).throw(s.S.invalidParameters),t.isPublic||(t.accessCode=null),n=new ec((0,s.l)({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return r=i.sent().as(eh).channel,[4,this._groupChannelCache.upsert([r])];case 2:return i.sent(),[2,r]}})})},e.prototype.markAsReadAll=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u;return(0,s.k)(this,function(l){switch(l.label){case 0:return e=Date.now(),(0,s.u)(e-this._markAsReadAllLastSentAt>=1e3).throw(s.S.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new ed({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:l.sent(),n=this._groupChannelCache.channels;try{for(i=(r=(0,s.z)(n)).next();!i.done;i=r.next())(a=i.value)._updateUnreadMemberState(this._sdkState.userId,e),a._updateUnreadCount(0,0)}catch(e){o={error:e}}finally{try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}}return n.length>0?[4,this._groupChannelCache.upsert(n)]:[3,3];case 2:l.sent(),l.label=3;case 3:return[2]}})})},e.prototype.markAsReadWithChannelUrls=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a,o,u,l,c;return(0,s.k)(this,function(h){switch(h.label){case 0:return t=Date.now(),(0,s.u)((0,s.T)("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(s.S.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new ed({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:h.sent(),r=this._groupChannelCache.channels,i=[];try{for(o=(a=(0,s.z)(r)).next();!o.done;o=a.next())u=o.value,e.includes(u.url)&&(u._updateUnreadMemberState(this._sdkState.userId,t),u._updateUnreadCount(0,0),i.push(u))}catch(e){l={error:e}}finally{try{o&&!o.done&&(c=a.return)&&c.call(a)}finally{if(l)throw l.error}}return i.length>0?[4,this._groupChannelCache.upsert(i)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[2]}})})},e.prototype.markAsDelivered=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}})})},e}(),eY=new Map,eW=new Map,eQ=new Map,eJ=function(){function e(t){var n=t.key,r=t.concurrentCallLimit,i=t.backOffDelay,a=this;this._holdersKey=e.createSemaphoreHoldersKey(n),this._resolversKey=e.createSemaphoreResolversKey(n),this._chainProcessStateKey=e.createChainProcessStateKey(n),this._numLocks=void 0===r?2:r,this._backOffDelay=void 0===i?0:i,this._localAcquiredKeys=[],this._localResolversData=[],(0,s.aW)()?(eY[this._holdersKey]||(eY[this._holdersKey]=[]),eW[this._resolversKey]||(eW[this._resolversKey]=[])):(window.addEventListener("storage",function(e){return(0,s.j)(a,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(r){if(this._localResolversData.length>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()&&this._hasHighestPriorityResolver())switch(e.key){case this._holdersKey:if(t=JSON.parse(e.oldValue),n=JSON.parse(e.newValue),!t||!n||n.length>=t.length)break;this._processChainResolve();break;case this._chainProcessStateKey:if(JSON.parse(e.newValue))break;this._processChainResolve()}return[2]})})}),window.addEventListener("beforeunload",function(){var e=a._getLocalResolversData(),t=a._localResolversData.map(function(e){return e.key}),n=e.filter(function(e){return 0>t.indexOf(e.key)});window.localStorage.setItem(a._resolversKey,JSON.stringify(n)),a._localAcquiredKeys.forEach(function(e){return a.release(e)})}))}return e.createSemaphoreHoldersKey=function(e){return"collection@semaphore_holders_for:"+e},e.createSemaphoreResolversKey=function(e){return"collection@semaphore_resolvers_for:"+e},e.createChainProcessStateKey=function(e){return"collection@semaphore_chain_process_state_for:"+e},Object.defineProperty(e.prototype,"numLocks",{get:function(){return this._numLocks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backOffDelay",{get:function(){return this._backOffDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numLocksAvailable",{get:function(){if((0,s.aW)())return this.numLocks-eY[this._holdersKey].length;var e=this._getLocalHoldersData();return this.numLocks-e.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waitCount",{get:function(){return(0,s.aW)()?eW[this._resolversKey].length:this._getLocalResolversData().length},enumerable:!1,configurable:!0}),e.prototype._hasHighestPriorityResolver=function(){var e=this._getLocalResolversData();return e.length>0&&this._localResolversData.map(function(e){return e.key}).indexOf(e[0].key)>=0},e.prototype._isProcessChainAcquireRunning=function(){if((0,s.aW)())return eQ[this._chainProcessStateKey];var e=window.localStorage[this._chainProcessStateKey];return void 0!==e&&JSON.parse(e)},e.prototype._setProcessChainAcquireRunning=function(e){(0,s.aW)()?eQ[this._chainProcessStateKey]=e:e?window.localStorage.setItem(this._chainProcessStateKey,JSON.stringify(e)):window.localStorage.removeItem(this._chainProcessStateKey)},e.prototype._processChainResolve=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return this.waitCount>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()?(this._setProcessChainAcquireRunning(!0),this._tryResolve()?[4,(0,s.aw)(this._backOffDelay)]:[3,2]):[3,3];case 1:e.sent(),e.label=2;case 2:this._setProcessChainAcquireRunning(!1),(0,s.aW)()?this._processChainResolve():dispatchEvent(new StorageEvent("storage",{key:this._chainProcessStateKey,oldValue:JSON.stringify(!0),newValue:JSON.stringify(!1)})),e.label=3;case 3:return[2]}})})},e.prototype.acquire=function(e){return void 0===e&&(e=0),(0,s.j)(this,void 0,void 0,function(){var t,n=this;return(0,s.k)(this,function(r){return(0,s.aW)()?[2,new Promise(function(t){for(var r={key:(0,s.ab)(),resolver:function(e){return t(e)},priority:e},i=eW[n._resolversKey],a=-1,o=0;o<i.length;o++)if(e>i[o].priority){a=o;break}a>=0?eW[n._resolversKey].splice(a,0,r):eW[n._resolversKey].push(r),n._processChainResolve()})]:(t=this._getLocalResolversData(),[2,new Promise(function(r){for(var i=(0,s.ab)(),a={key:i,priority:e},o={key:i,resolver:function(e){return r(e)},priority:e},u=-1,l=0;l<t.length;l++)if(e>t[l].priority){u=l;break}u>=0?(t.splice(u,0,a),n._localResolversData.splice(u,0,o)):(t.push(a),n._localResolversData.push(o)),window.localStorage.setItem(n._resolversKey,JSON.stringify(t)),n._processChainResolve()})])})})},e.prototype.release=function(e){if((0,s.aW)()){if((t=eY[this._holdersKey].indexOf(e))>=0)return eY[this._holdersKey].splice(t,1),this._processChainResolve(),!0}else if(window.localStorage[this._holdersKey]){var t,n=JSON.parse(window.localStorage[this._holdersKey]),r=(0,s.Z)([],(0,s.Y)(n),!1);if((t=n.indexOf(e))>=0)return n.splice(t,1),window.localStorage.setItem(this._holdersKey,JSON.stringify(n)),this._localAcquiredKeys.splice(this._localAcquiredKeys.indexOf(e),1),dispatchEvent(new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(r),newValue:JSON.stringify(n)})),!0}return!1},e.prototype._tryResolve=function(){if((0,s.aW)()){if(eY[this._holdersKey].length<this.numLocks){var e=(0,s.ab)();return eY[this._holdersKey]=(0,s.Z)((0,s.Z)([],(0,s.Y)(eY[this._holdersKey]),!1),[e],!1),(n=eW[this._resolversKey].shift()).resolver(e),!0}}else{var t=this._getLocalHoldersData();if(t.length<this.numLocks){e=(0,s.ab)();var n=this._localResolversData.shift(),r=this._getLocalResolversData(),i=r.map(function(e){return e.key}).indexOf(n.key);return r.splice(i,1),window.localStorage.setItem(this._resolversKey,JSON.stringify(r)),window.localStorage.setItem(this._holdersKey,JSON.stringify((0,s.Z)((0,s.Z)([],(0,s.Y)(t),!1),[e],!1))),this._localAcquiredKeys.push(e),dispatchEvent(new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify((0,s.Z)([],(0,s.Y)(t),!1)),newValue:JSON.stringify((0,s.Z)((0,s.Z)([],(0,s.Y)(t),!1),[e],!1))})),(0,n.resolver)(e),!0}}return!1},e.prototype._getLocalHoldersData=function(){var e=window.localStorage[this._holdersKey];return void 0!==e?JSON.parse(e):[]},e.prototype._getLocalResolversData=function(){var e=window.localStorage[this._resolversKey];return void 0!==e?JSON.parse(e):[]},e}();(eZ=ek||(ek={}))[eZ.IDLE=0]="IDLE",eZ[eZ.RUNNING=1]="RUNNING",eZ[eZ.END=2]="END";var eZ,eX,e$=function(e){function t(t,n,r,s){void 0===r&&(r=2),void 0===s&&(s=10);var i=e.call(this)||this;return i._worker=null,i._state=ek.IDLE,i._semaphore=null,i._retryCount=0,i._retryLimit=3,i.priority=0,i._worker=n,i._semaphore=new eJ({key:t,concurrentCallLimit:r,backOffDelay:s}),i}return(0,s._)(t,e),Object.defineProperty(t.prototype,"isIdle",{get:function(){return this._state===ek.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._state===ek.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDone",{get:function(){return this._state===ek.END},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),t.prototype._run=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}})})},t.prototype.start=function(e){this.isIdle&&(this._state=ek.RUNNING,this._run(e))},t.prototype.stop=function(){this._state=ek.IDLE,this.dispatch("stop")},t.prototype.end=function(){this._state=ek.END,this.dispatch("end")},t}(s.E),e0=function(e){this.source=e},e1=function(e){this.source=e},e2={},e3=function(){function e(e){var t,n,r=e._iid,i=e.channel,a=this;this._prevSync=null,this._nextSync=null,this._metadata=null,this._iid=r,this._channel=i;var o,u,l=s.V.of(this._iid),c=l.sdkState,h=l.logger;this._metadataKey=(o=c.userId,u=i.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/message/sync.meta"));var d=(t=c.userId,n=i.url,"sendbird:".concat(t,"@groupchannel/").concat(n,"/message/sync"));this._prevSync=new e$(d,function(e){return(0,s.j)(a,void 0,void 0,function(){var t,n,r,i,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:if(u.sent(),h.debug("message background prev sync from",null===(i=this._metadata)||void 0===i?void 0:i.range.top),this._metadata.previousComplete)return[3,9];u.label=2;case 2:return u.trys.push([2,5,,8]),[4,s.y.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(o=null===(a=this._metadata.range)||void 0===a?void 0:a.top)&&void 0!==o?o:e,{prevResultSize:100,nextResultSize:0,replyType:s.R.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},s.M.SYNC_MESSAGE_BACKGROUND)];case 3:return n=u.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.top,this._metadata.previousComplete=!t.hasNext,h.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return u.sent(),[3,8];case 5:return r=u.sent(),h.debug("message background prev sync error",r),r instanceof s.S&&r.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:u.sent(),u.label=7;case 7:throw r;case 8:return[3,10];case 9:t.hasNext=!1,u.label=10;case 10:return[2,t]}})})}),this._nextSync=new e$(d,function(e){return(0,s.j)(a,void 0,void 0,function(){var t,n,r,i,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:u.sent(),h.debug("message background next sync from",null===(i=this._metadata)||void 0===i?void 0:i.range.bottom),u.label=2;case 2:return u.trys.push([2,5,,6]),[4,s.y.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(o=null===(a=this._metadata.range)||void 0===a?void 0:a.bottom)&&void 0!==o?o:e,{prevResultSize:0,nextResultSize:100,replyType:s.R.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},s.M.SYNC_MESSAGE_BACKGROUND)];case 3:return n=u.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.bottom,h.debug("message background next sync progress",t),[4,this.saveMetadata()];case 4:return u.sent(),[3,6];case 5:throw r=u.sent(),h.debug("message background next sync error",r),r;case 6:return[2,t]}})})})}return e.of=function(t,n){if(e2[t]||(e2[t]={}),!e2[t][n.url]){var r=e2[t][n.url]=new e({_iid:t,channel:n});s.V.of(t).dispatcher.on(function(e){e instanceof s.H&&(e.stateType===s.J.CONNECTED?r.resume():r.pause())})}return e2[t][n.url]},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,(0,s.Z)([],(0,s.Y)(e.map(function(e){return e.createdAt})),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,(0,s.Z)([],(0,s.Y)(e.map(function(e){return e.createdAt})),!1))},e.prototype.loadMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){var e;return(0,s.k)(this,function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,s.V.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={range:new ez(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:Number.MAX_SAFE_INTEGER}),previousComplete:!!e&&e.previousComplete},t.label=2;case 2:return[2]}})})},e.prototype.saveMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.clearMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){var e,t,n,r;s.V.of(this._iid).logger.debug("message background sync resume()"),this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:Date.now())},e.prototype.pause=function(){s.V.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e}(),e4={},e6=function(){function e(e){var t,n,r=e._iid,i=e.channel,a=this;this._sync=null,this._metadata=null,this._iid=r,this._channel=i;var o,u,l=s.V.of(this._iid),c=l.logger,h=l.sdkState;this._metadataKey=(o=h.userId,u=i.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/message/changelogs.meta"));var d=(t=h.userId,n=this._channel.url,"sendbird:".concat(t,"@groupchannel/").concat(n,"/message/changelogs"));this._sync=new e$(d,function(){return(0,s.j)(a,void 0,void 0,function(){var e,t,n,r,i,a;return(0,s.k)(this,function(o){switch(o.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:o.sent(),c.debug("message changelog sync from",null===(a=this._metadata)||void 0===a?void 0:a.token),o.label=2;case 2:return o.trys.push([2,5,,8]),[4,s.y.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:s.R.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},s.M.SYNC_MESSAGE_CHANGELOGS)];case 3:return n=(t=o.sent()).hasMore,r=t.token,e.hasNext=n,e.nextToken=r,this._metadata.token=r,c.debug("message changelog sync progress",e),[4,this.saveMetadata()];case 4:return o.sent(),[3,8];case 5:return i=o.sent(),c.debug("message changelog sync error",i),i instanceof s.S&&i.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:o.sent(),o.label=7;case 7:throw i;case 8:return[2,e]}})})})}return e.of=function(t,n){if(e4[t]||(e4[t]={}),!e4[t][n.url]){var r=e4[t][n.url]=new e({_iid:t,channel:n});s.V.of(t).dispatcher.on(function(e){e instanceof s.H&&(e.stateType===s.J.CONNECTED?r.resume():r.pause())})}return e4[t][n.url]},e.prototype.loadMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return this._metadata?[3,2]:(t=(e=s.V.of(this._iid)).cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=i.sent(),this._metadata={token:r?r.token:n/1e3},i.label=2;case 2:return[2]}})})},e.prototype.saveMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.clearMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){s.V.of(this._iid).logger.debug("message changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){s.V.of(this._iid).logger.debug("message changelog sync pause()"),this._sync.stop()},e}(),e7=function(e){function t(t){var n,r,i,a,o,u,l=this;return(l=e.call(this)||this).method=s.A.GET,l.path="".concat((0,s.g)(t.channelType),"/").concat(t.channelUrl,"/messages_gap"),l.params=(0,s.e)({prev_start_ts:t.prevStart,prev_end_ts:t.prevEnd,prev_cache_count:t.prevCount,next_start_ts:t.nextStart,next_end_ts:t.nextEnd,next_cache_count:t.nextCount,huge_gap_threshold:null!==(n=t.threshold)&&void 0!==n?n:null,reverse:!0,custom_types:null!==(r=t.customTypes)&&void 0!==r?r:["*"],message_type:null!==(i=t.messageType)&&void 0!==i?i:null,include_reactions:null===(a=t.includeReactions)||void 0===a||a,with_sorted_meta_array:null===(o=t.includeMetaArray)||void 0===o||o,show_subchannel_messages_only:null!==(u=t.showSubchannelMessagesOnly)&&void 0!==u&&u,include_poll_details:!0}),l}return(0,s._)(t,e),t}(s.b),e5=function(e){function t(t,n){var r,i,a,o,u=this;return(u=e.call(this,t,n)||this).isHugeGap=n.is_huge_gap,u.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map(function(e){return(0,s.aX)(t,e)}),u.prevHasMore=null!==(i=n.prev_hasmore)&&void 0!==i&&i,u.nextMessages=(null!==(a=n.next_messages)&&void 0!==a?a:[]).map(function(e){return(0,s.aX)(t,e)}),u.nextHasmore=null!==(o=n.next_hasmore)&&void 0!==o&&o,u}return(0,s._)(t,e),t}(s.c),e8=function(e,t){return e.findIndex(function(e){return e.isIdentical(t)})},e9=function(e,t,n){if(e.length>0){var r=e8(e,t);if(r<0){for(var s=0,i=e.length-1,a=Math.floor((s+i)/2);s<i;){var o=te(e[a],t,n);if(o>0)a=Math.floor((s+(i=a))/2);else{if(!(o<0))return{place:a,contains:e[a].isIdentical(t)};a=Math.floor(((s=a+1)+i)/2)}}return{place:te(e[a],t,n)>0?a:a+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},te=function(e,t,n){switch(n){case i.G.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?t.lastMessage.createdAt-e.lastMessage.createdAt:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case i.G.CHRONOLOGICAL:return t.createdAt-e.createdAt;case i.G.CHANNEL_NAME_ALPHABETICAL:return e.name.localeCompare(t.name)}},tt=function(e,t){return t instanceof s.w?e.findIndex(function(e){return e instanceof s.w&&t.isIdentical(e)}):e.findIndex(function(e){return e.isIdentical(t)})},tn=function(e,t){return e.findIndex(function(e){return e.messageId===t})},tr=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,s=Math.floor((n+r)/2);n<r;){var i=e[s].createdAt-t.createdAt;if(i>0)s=Math.floor((n+(r=s))/2);else{if(!(i<0))return s;s=Math.floor(((n=s+1)+r)/2)}}return e[s].createdAt>t.createdAt?s:s+1}return e.length},ts={},ti=function(){function e(e){var t,n,r=e._iid,a=e.channel,o=e.hasPollMessage,u=this;this._sync=null,this._metadata=null,this._iid=r,this._channel=a;var l,c,h=s.V.of(this._iid),d=h.logger,_=h.sdkState;this._metadataKey=(l=_.userId,c=a.url,"sendbird:".concat(l,"@groupchannel/").concat(c,"/poll/changelogs.meta"));var p=(t=_.userId,n=this._channel.url,"sendbird:".concat(t,"@groupchannel/").concat(n,"/poll/changelogs"));this._sync=new e$(p,function(){return(0,s.j)(u,void 0,void 0,function(){var e,t,n,r,a,u,l,c;return(0,s.k)(this,function(h){switch(h.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return h.sent(),d.debug("poll changelog sync from",null===(c=this._metadata)||void 0===c?void 0:c.token),(t=!this._metadata||!this._metadata.token)?[4,o()]:[3,3];case 2:t=!h.sent(),h.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];this._metadata||(n=s.V.of(this._iid).firstConnectedAt,this._metadata={token:n/1e3}),h.label=4;case 4:return h.trys.push([4,7,,10]),[4,i.h.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return a=(r=h.sent()).hasMore,u=r.token,e.hasNext=a,e.nextToken=u,this._metadata.token=u,d.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return h.sent(),[3,10];case 7:return l=h.sent(),d.debug("poll changelog sync error",l),l instanceof s.S&&l.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:h.sent(),h.label=9;case 9:throw l;case 10:return[2,e]}})})})}return e.of=function(t,n,r){if(ts[t]||(ts[t]={}),!ts[t][n.url]){var i=ts[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r});s.V.of(t).dispatcher.on(function(e){e instanceof s.H&&(e.stateType===s.J.CONNECTED?i.resume():i.pause())})}return ts[t][n.url]},e.prototype.loadMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){var e;return(0,s.k)(this,function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,s.V.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{token:e.token}:null,t.label=2;case 2:return[2]}})})},e.prototype.saveMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.clearMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){s.V.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){s.V.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e}();(eX||(eX={})).CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api";var ta,to,tu,tl=function(){function e(){}return e.prototype._invokeResponse=function(e,t,n){var r=this;(0,s.a6)(function(){return(0,s.j)(r,void 0,void 0,function(){return(0,s.k)(this,function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]})})})},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),tc=function(){function e(e,t){var n=t.channel,r=t.filter,a=t.startingPoint,o=t.limit,u=this;this._channel=null,this._messages=[],this._unsentMessages=[],this._readReceiptMap=new Map,this._deliveryReceiptMap=new Map,this._iid=e,this._key="mc-".concat((0,s.ab)()),this.filter=null!=r?r:new i.i,this._channel=n,this._syncRange=new ez({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint=a||Date.now()+6e5,this._limit=o||i.f;var l=eB.of(this._iid);l.subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n,r,i,a,o=e8(e,u._channel);if(o>=0)switch((0,s.a6)(function(){return(0,s.j)(u,void 0,void 0,function(){var n;return(0,s.k)(this,function(r){return n=new e0(t),this._channel=e[o],this._handler.onChannelUpdated(n,this.channel),[2]})})}),t){case F.EVENT_CHANNEL_UPDATED:var l=!1;for(var c in u._messages)if((m=u._messages[c]).createdAt>=u._channel.messageOffsetTimestamp){l=!0;var h=parseInt(c);if(h>0){var d=u._messages.splice(0,h);u._removeMessagesFromView(d.map(function(e){return e.messageId}),s.M.EVENT_MESSAGE_OFFSET_UPDATED)}break}!l&&u._messages.length>0&&u._removeMessagesFromView(u._messages.map(function(e){return e.messageId}),s.M.EVENT_MESSAGE_OFFSET_UPDATED);break;case F.EVENT_CHANNEL_READ:var _=[];try{for(var p=(0,s.z)(u._messages),f=p.next();!f.done;f=p.next()){var m=f.value;(v=u._readReceiptMap.get(m.messageId))>0&&v!==u._channel.getUnreadMemberCount(m)&&_.push(m)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}_.length>0&&u._updateMessagesToView(_,s.M.EVENT_MESSAGE_READ);break;case F.EVENT_CHANNEL_DELIVERED:_=[];try{for(var v,g=(0,s.z)(u._messages),y=g.next();!y.done;y=g.next())m=y.value,(v=u._deliveryReceiptMap.get(m.messageId))>0&&v!==u._channel.getUndeliveredMemberCount(m)&&_.push(m)}catch(e){i={error:e}}finally{try{y&&!y.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}_.length>0&&u._updateMessagesToView(_,s.M.EVENT_MESSAGE_READ)}},onRemove:function(e,t){e.indexOf(u.channel.url)>=0&&(0,s.a6)(function(){return(0,s.j)(u,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e0(t),this._handler.onChannelDeleted(e,this.channel.url),[2]})})})}}),l.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,r,i=[],a=[];try{for(var o=(0,s.z)(e),l=o.next();!l.done;l=o.next()){var c=l.value;c.channelUrl===u._channel.url&&(u.filter.match(c)?i.push(c):a.push(c.messageId))}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}if((0,s.aY)(t)){if(i.length>0)switch(t){case s.M.EVENT_MESSAGE_SENT_FAILED:case s.M.EVENT_MESSAGE_SENT_SUCCESS:case s.M.EVENT_MESSAGE_UPDATED:case s.M.EVENT_MESSAGE_THREADINFO_UPDATED:case s.M.EVENT_MESSAGE_REACTION_UPDATED:case s.M.SYNC_MESSAGE_CHANGELOGS:u._updateMessagesToView(i,t);break;case s.M.EVENT_MESSAGE_SENT_PENDING:case s.M.EVENT_MESSAGE_RECEIVED:case s.M.SYNC_MESSAGE_FILL:u._addMessagesToView(i,t)}a.length>0&&u._removeMessagesFromView(a,t)}},onRemove:function(e,t){u._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){u._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){u._updatePollsToView(e,t)},onPollUpdate:function(e,t){u._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){u._applyPollVoteEventToView(e,t)}});var c=s.V.of(this._iid).cacheContext;!this._channel.isSuper&&c.localCacheEnabled&&e3.of(this._iid,this._channel).resume(),e6.of(this._iid,this._channel).resume(),ti.of(this._iid,this._channel,this._hasPollMessage.bind(this)).resume(),this._prevFill=new e$(this._key,function(e){return(0,s.j)(u,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._limit,source:s.M.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.min.apply(Math,(0,s.Z)([],(0,s.Y)(t.map(function(e){return e.createdAt})),!1)),this._syncRange.extends(n),[2,{hasNext:t.length>=this._limit&&this.viewTop<n,nextToken:this._syncRange.top}]):[2,{hasNext:!1,nextToken:0}]}})})}),this._nextFill=new e$(this._key,function(e){return(0,s.j)(u,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._limit,source:s.M.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.max.apply(Math,(0,s.Z)([],(0,s.Y)(t.map(function(e){return e.createdAt})),!1)),this._syncRange.extends(n),[2,{hasNext:!(t.length>=this._limit&&this._hasNext)||this.viewBottom>n,nextToken:this._syncRange.bottom}]):[2,{hasNext:!1,nextToken:0}]}})})});var h=s.V.of(this._iid),d=h.dispatcher,_=h.logger;d.on(function(e){e instanceof s.H&&(e.stateType===s.J.CONNECTED?(_.debug("check huge gap"),u._checkHugeGap()):(u._prevFill.stop(),u._nextFill.stop()))})}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return(0,s.Z)([],(0,s.Y)(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter(function(e){return e.sendingStatus===s.D.FAILED})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter(function(e){return e.sendingStatus===s.D.PENDING})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,(0,s.Z)((0,s.Z)([],(0,s.Y)(this._messages.map(function(e){return e.createdAt})),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,(0,s.Z)((0,s.Z)([],(0,s.Y)(this._messages.map(function(e){return e.createdAt})),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype.setMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){return e},e.prototype._addMessagesToView=function(e,t){var n,r,i=this,a=this._filterUnderOffsetMessage(e),o=[],u=[];try{for(var l=(0,s.z)(a),c=l.next();!c.done;c=l.next()){var h,d=c.value;if(t===s.M.SYNC_MESSAGE_FILL){if(d.messageId>0){if((h=tt(this._messages,d))<0){0>tt(this._unsentMessages,d)&&o.push(d);var _=tr(this._messages,d);this._messages.splice(_,0,d)}this._readReceiptMap.set(d.messageId,this._channel.getUnreadMemberCount(d)),this._deliveryReceiptMap.set(d.messageId,this._channel.getUndeliveredMemberCount(d))}else d instanceof s.w&&(h=tt(this._unsentMessages,d))<0&&0>tt(this._messages,d)&&(this._unsentMessages.push(d),o.push(d))}else if(d.messageId>0){if((h=tt(this._messages,d))<0){var p=tt(this._unsentMessages,d);p<0?o.push(d):(this._unsentMessages.splice(p,1),u.push(d)),_=tr(this._messages,d),this._messages.splice(_,0,d)}else u.push(d),this._messages[h]=d;if(this._readReceiptMap.set(d.messageId,this._channel.getUnreadMemberCount(d)),this._deliveryReceiptMap.set(d.messageId,this._channel.getUndeliveredMemberCount(d)),d.updatedAt>0){var f=this._updateChildMessagesInView(d);u.push.apply(u,(0,s.Z)([],(0,s.Y)(f),!1))}}else d instanceof s.w&&((h=tt(this._unsentMessages,d))<0?0>tt(this._messages,d)&&(this._unsentMessages.push(d),o.push(d)):(u.push(d),this._unsentMessages[h]=d))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}(0,s.aY)(t)&&(0,s.a6)(function(){return(0,s.j)(i,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e1(t),o.length>0&&this._handler.onMessagesAdded(e,this.channel,o),u.length>0&&this._handler.onMessagesUpdated(e,this.channel,u),[2]})})})},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach(function(n){n.applyParentMessage(e)&&t.push(n)}),t},e.prototype._updatePollsToView=function(e,t){var n,r,i=this,a=[];try{for(var o=(0,s.z)(e),u=o.next();!u.done;u=o.next()){var l=u.value,c=tn(this._messages,l.messageId);if(c>=0){var h=this._messages[c];h&&h.applyPoll(l),a.push(h)}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a.length>0&&(0,s.aY)(t)&&(0,s.a6)(function(){return(0,s.j)(i,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e1(t),a.length>0&&this._handler.onMessagesUpdated(e,this.channel,a),[2]})})}),a},e.prototype._applyPollUpdateEventToView=function(e,t){var n=this,r=tn(this._messages,e.messageId);if(r>=0){var i=this._messages[r];i&&i.isUserMessage()&&i.poll&&i.poll.applyPollUpdateEvent(e)&&(0,s.aY)(t)&&(0,s.a6)(function(){return(0,s.j)(n,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e1(t),this._handler.onMessagesUpdated(e,this.channel,[i]),[2]})})})}},e.prototype._applyPollVoteEventToView=function(e,t){var n=this,r=tn(this._messages,e.messageId);if(r>=0){var i=this._messages[r];i&&i.isUserMessage()&&i.poll&&i.poll.applyPollVoteEvent(e)&&(0,s.aY)(t)&&(0,s.a6)(function(){return(0,s.j)(n,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e1(t),this._handler.onMessagesUpdated(e,this.channel,[i]),[2]})})})}},e.prototype._updateMessagesToView=function(e,t){var n,r,i=this,a=[];try{for(var o=(0,s.z)(e),u=o.next();!u.done;u=o.next()){var l,c=u.value;if(c.messageId>0){if((l=tt(this._messages,c))>=0)a.push(c),this._messages[l]=c;else{var h=tt(this._unsentMessages,c);if(h>=0){a.push(c),this._unsentMessages.splice(h,1);var d=tr(this._messages,c);this._messages.splice(d,0,c)}}}else c instanceof s.w&&(l=tt(this._unsentMessages,c))>=0&&(a.push(c),this._unsentMessages[l]=c)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return(0,s.aY)(t)&&(0,s.a6)(function(){return(0,s.j)(i,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e1(t),a.length>0&&this._handler.onMessagesUpdated(e,this.channel,a),[2]})})}),a},e.prototype._removeMessagesFromView=function(e,t){var n,r,i=this,a=[],o=function(e){var t=u._messages.findIndex(function(t){return t.messageId===e});t>=0&&(a.push(u._messages[t].messageId),u._messages.splice(t,1))},u=this;try{for(var l=(0,s.z)(e),c=l.next();!c.done;c=l.next())o(c.value)}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return(0,s.aY)(t)&&a.length>0&&(0,s.a6)(function(){return(0,s.j)(i,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e1(t),a.length>0&&this._handler.onMessagesDeleted(e,this.channel,a),[2]})})}),a},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex(function(t){return t.reqId===e});n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,i=t.nextLimit,a=void 0===i?0:i;return(0,s.j)(this,void 0,void 0,function(){var t,n,i,o,u,l,c;return(0,s.k)(this,function(h){switch(h.label){case 0:return t=eB.of(this._iid),r>0?[4,t.getMessagesFromCache(this._channel.url,e,"prev",this.filter,this._limit)]:[3,2];case 1:return i=h.sent(),[3,3];case 2:i=[],h.label=3;case 3:return n=i,a>0?[4,t.getMessagesFromCache(this._channel.url,e,"next",this.filter,this._limit)]:[3,5];case 4:return u=h.sent(),[3,6];case 5:u=[],h.label=6;case 6:if(o=u,n.length>0&&o.length){for(c in l=n.map(function(e){return e.messageId}),o)if(l.includes(o[c].messageId)){o.splice(parseInt(c),1);break}}return[2,(0,s.Z)((0,s.Z)([],(0,s.Y)(n),!1),(0,s.Y)(o),!1).sort(function(e,t){return t.createdAt-e.createdAt})]}})})},e.prototype._getRemoteMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,i=t.nextLimit,a=void 0===i?0:i,o=t.source,u=void 0===o?s.M.REQUEST_MESSAGE:o,l=t.reverse,c=void 0!==l&&l;return(0,s.j)(this,void 0,void 0,function(){var t,n;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=s.y.of(this._iid),r>0||a>0?[4,t.getMessagesByTimestamp(this._channel.url,this._channel.channelType,e,(0,s.l)((0,s.l)({},this.filter),{reverse:c,prevResultSize:r,nextResultSize:a,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),u)]:[3,2];case 1:return n=i.sent(),[3,3];case 2:n=[],i.label=3;case 3:return[2,n]}})})},e.prototype._checkHugeGap=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u,l,c,h=this;return(0,s.k)(this,function(d){switch(d.label){case 0:return this._messages.length>0?(e=this.viewTop,t=this._syncRange.top,n=this._syncRange.bottom,r=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,(i=eB.of(this._iid)).getCachedMessageCountBetween(this._channel.url,this.filter,e,t)]):[3,4];case 1:return a=d.sent(),[4,i.getCachedMessageCountBetween(this._channel.url,this.filter,n,r)];case 2:return o=d.sent(),[4,(0,s.aZ)(function(){return(0,s.j)(h,void 0,void 0,function(){var i,u,l,c,h,d,_,p,f,m,v,g,y,E,C,b,N=this;return(0,s.k)(this,function(M){switch(M.label){case 0:return u=(i=s.V.of(this._iid)).dispatcher,l=i.requestQueue,c=new e7((0,s.l)({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:e,prevEnd:t,prevCount:a,nextStart:n,nextEnd:r,nextCount:o},this.filter)),[4,l.send(c)];case 1:return d=(h=M.sent().as(e5)).isHugeGap,p=void 0===(_=h.prevMessages)?[]:_,f=h.prevHasMore,v=void 0===(m=h.nextMessages)?[]:m,g=h.nextHasmore,d?(0,s.a6)(function(){return(0,s.j)(N,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._handler.onHugeGapDetected(),[2]})})}):(this._hasPrevious=f,this._hasNext=g,y=this.viewTop,E=this.viewBottom,C=Math.min.apply(Math,(0,s.Z)([Number.MAX_SAFE_INTEGER],(0,s.Y)(p.map(function(e){return e.createdAt})),!1)),b=Math.max.apply(Math,(0,s.Z)([0],(0,s.Y)(v.map(function(e){return e.createdAt})),!1)),u.dispatch(new s.L({messages:p,source:s.M.SYNC_MESSAGE_FILL})),u.dispatch(new s.L({messages:v,source:s.M.SYNC_MESSAGE_FILL})),this._syncRange.extends(C,b),y<C&&this._prevFill.start(C),E>b&&this._nextFill.start(b)),[2]}})})},1)];case 3:return d.sent(),[3,6];case 4:return u=Math.floor(this._limit/2),[4,this._getRemoteMessages(Date.now(),{prevLimit:u,nextLimit:u,source:s.M.SYNC_MESSAGE_FILL})];case 5:(l=d.sent()).length>0&&((c=this._syncRange).extends.apply(c,(0,s.Z)([],(0,s.Y)(l.map(function(e){return e.createdAt})),!1)),l.length<u&&(this._hasPrevious=!1,this._hasNext=!1)),d.label=6;case 6:return[2]}})})},e.prototype._loadUnsentMessages=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t;return(0,s.k)(this,function(n){switch(n.label){case 0:return e=eB.of(this._iid),t=this,[4,e.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return t._unsentMessages=n.sent(),[2]}})})},e.prototype._hasPollMessage=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,eB.of(this._iid).getPollMessagesFromCache(this._channel.url,Date.now()+6e5,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}})})},e.prototype.initialize=function(e){var t=this,n=new tl;this._messages=[],this._unsentMessages=[],this._syncRange=new ez({}),this._hasNext=!0,this._hasPrevious=!0;var r=Math.floor(this._limit/2);return e===eX.CACHE_AND_REPLACE_BY_API&&this._getLocalMessages(this._startingPoint,{prevLimit:r,nextLimit:r}).then(function(e){return(0,s.j)(t,void 0,void 0,function(){var t;return(0,s.k)(this,function(r){switch(r.label){case 0:return t=this._filterUnderOffsetMessage(e),this._addMessagesToView(t,s.M.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return r.sent(),n._invokeResponse("local",null,t),[2]}})})}).catch(function(e){if((0,s.ax)(e))throw e;n._invokeResponse("local",e,null)}).finally(function(){t._getRemoteMessages(t._startingPoint,{prevLimit:r,nextLimit:r,reverse:!0}).then(function(e){t._messages=[];var i,a=t._filterUnderOffsetMessage(e);a.length<r&&(t._hasPrevious=!1,t._hasNext=!1),a.length>0&&((i=t._syncRange).extends.apply(i,(0,s.Z)([],(0,s.Y)(a.map(function(e){return e.createdAt})),!1)),t._addMessagesToView(a,s.M.REQUEST_MESSAGE)),n._invokeResponse("remote",null,a)}).catch(function(e){if((0,s.ax)(e))throw e;n._invokeResponse("remote",e,null)})}),n},e.prototype.loadPrevious=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i=this;return(0,s.k)(this,function(a){switch(a.label){case 0:return this._hasPrevious?(e=this.viewTop,t=[],[4,(0,s.aJ)(function(){return(0,s.j)(i,void 0,void 0,function(){var n;return(0,s.k)(this,function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{prevLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}})})})]):[3,5];case 1:return a.sent(),n=e3.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,(0,s.aJ)(function(){return(0,s.j)(i,void 0,void 0,function(){var r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{prevLimit:this._limit})];case 1:return t=r.apply(this,[a.sent()]),this._hasPrevious=t.length>=this._limit,t.length>0&&((i=this._syncRange).extends.apply(i,(0,s.Z)([],(0,s.Y)(t.map(function(e){return e.createdAt})),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.top)),[2]}})})})];case 2:return a.sent(),this._addMessagesToView(t,s.M.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=t.length>=this._limit,t.length>0&&((r=this._syncRange).extends.apply(r,(0,s.Z)([],(0,s.Y)(t.map(function(e){return e.createdAt})),!1)),this._addMessagesToView(t,s.M.REQUEST_MESSAGE)),a.label=4;case 4:return[2,t];case 5:return[2,[]]}})})},e.prototype.loadNext=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i=this;return(0,s.k)(this,function(a){switch(a.label){case 0:return e=this.viewBottom,t=[],[4,(0,s.aJ)(function(){return(0,s.j)(i,void 0,void 0,function(){var n;return(0,s.k)(this,function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{nextLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}})})})];case 1:return a.sent(),n=e3.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,(0,s.aJ)(function(){return(0,s.j)(i,void 0,void 0,function(){var r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{nextLimit:this._limit})];case 1:return t=r.apply(this,[a.sent()]),this._hasNext=t.length>=this._limit,t.length>0&&((i=this._syncRange).extends.apply(i,(0,s.Z)([],(0,s.Y)(t.map(function(e){return e.createdAt})),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.bottom)),[2]}})})})];case 2:return a.sent(),this._addMessagesToView(t,s.M.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=t.length>=this._limit,t.length>0&&((r=this._syncRange).extends.apply(r,(0,s.Z)([],(0,s.Y)(t.map(function(e){return e.createdAt})),!1)),this._addMessagesToView(t,s.M.REQUEST_MESSAGE)),a.label=4;case 4:return[2,t]}})})},e.prototype.removeFailedMessage=function(e){return(0,s.j)(this,void 0,void 0,function(){var t;return(0,s.k)(this,function(n){switch(n.label){case 0:return[4,eB.of(this._iid).removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex(function(t){return t.reqId===e}))>-1&&this._unsentMessages.splice(t,1),[2]}})})},e.prototype.dispose=function(){s.V.of(this._iid).cacheContext.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop(),e3.of(this._iid,this._channel).pause()),e6.of(this._iid,this._channel).pause(),ti.of(this._iid,this._channel,this._hasPollMessage.bind(this)).pause();var e=eB.of(this._iid);e.unsubscribeGroupChannelEvent(this._key),e.unsubscribeMessageEvent(this._key)},e}(),th={coverUrl:null,coverImage:null,isDistinct:null,isPublic:null,isDiscoverable:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},td={hidePreviousMessages:!1,allowAutoUnhide:!0},t_=function(e){function t(t){var n=this,r=t.channelUrl,i=t.token,a=t.limit,o=t.order,u=t.mutedMemberFilter,l=t.memberStateFilter,c=t.nicknameStartsWithFilter,h=t.operatorFilter;return(n=e.call(this)||this).method=s.A.GET,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/members"),n.params={token:i,limit:a,order:o,muted_member_filter:u,member_state_filter:l,nickname_startswith:c,operator_filter:h,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return(0,s._)(t,e),t}(s.b),tp=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.members=[];var s=n.next,i=n.members;return r.token=s,i&&i.length>0&&(r.members=i.map(function(e){return new g(t,e)})),r}return(0,s._)(t,e),t}(s.c);(tY=ta||(ta={})).ALL="all",tY.MUTED="muted",tY.UNMUTED="unmuted",(tW=to||(to={})).MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",tW.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical",(tQ=tu||(tu={})).ALL="all",tQ.JOINED="joined_only",tQ.INVITED="invited_only",tQ.INVITED_BY_FRIEND="invited_by_friend",tQ.INVITED_BY_NON_FRIEND="invited_by_non_friend";var tf=function(e){function t(t,n,r){var i,a,o,u,l=this;return(l=e.call(this,t,n,s.C.GROUP,r)||this).mutedMemberFilter=ta.ALL,l.memberStateFilter=tu.ALL,l.nicknameStartsWithFilter=null,l.operatorFilter=f.ALL,l.order=to.MEMBER_NICKNAME_ALPHABETICAL,l.mutedMemberFilter=null!==(i=r.mutedMemberFilter)&&void 0!==i?i:ta.ALL,l.memberStateFilter=null!==(a=r.memberStateFilter)&&void 0!==a?a:tu.ALL,l.nicknameStartsWithFilter=null!==(o=r.nicknameStartsWithFilter)&&void 0!==o?o:null,l.order=null!==(u=r.order)&&void 0!==u?u:to.MEMBER_NICKNAME_ALPHABETICAL,l}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.h)(ta,this.mutedMemberFilter)&&(0,s.h)(tu,this.memberStateFilter)&&((0,s.i)("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&(0,s.h)(f,this.operatorFilter)&&(0,s.h)(to,this.order)},t.prototype.next=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=s.V.of(this._iid).requestQueue,t=new t_((0,s.l)((0,s.l)({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=(n=a.sent().as(tp)).members,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.n),tm=function(e){function t(t){var n=this,r=t.channelUrl,i=t.userId,a=t.accessCode;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:i,access_code:a},n}return(0,s._)(t,e),t}(s.b),tv=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new t9(t,n),r.channel.myMemberState=l.JOINED,r}return(0,s._)(t,e),t}(s.c),tg=function(e){function t(t){var n=this,r=t.channelUrl,i=t.isDistinct,a=t.isPublic,o=t.isDiscoverable,u=t.coverUrl,l=t.coverImage,c=t.accessCode,h=t.name,d=t.data,_=t.customType,p=t.operatorUserIds,f=t.messageSurvivalSeconds;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r)),n.params=(0,s.e)({is_distinct:i,is_public:a,is_discoverable:o,name:h,data:d,custom_type:_,cover_url:u,cover_file:l,access_code:c,operator_ids:p,message_survival_seconds:f}),n}return(0,s._)(t,e),t}(s.b),ty=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new t9(t,n),r}return(0,s._)(t,e),t}(s.c),tE=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=s.A.DELETE,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r)),n}return(0,s._)(t,e),t}(s.b);tJ=s.c,(0,s._)(function(e,t){return tJ.call(this,e,t)||this},tJ);var tC=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=s.A.DELETE,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/hide"),n}return(0,s._)(t,e),t}(s.b);tZ=s.c,(0,s._)(function(){return null!==tZ&&tZ.apply(this,arguments)||this},tZ);var tb=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=t.countPreference,a=e.call(this)||this;return a.method=s.A.PUT,a.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),a.params={count_preference:i},a}return(0,s._)(t,e),t}(s.b),tN=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.countPreference=t1[n.count_preference],r}return(0,s._)(t,e),t}(s.c),tM=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.aP,"/").concat(encodeURIComponent(r),"/reset_user_history"),n}return(0,s._)(t,e),t}(s.b),tS=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return(0,s._)(t,e),t}(s.c),tT=(0,s.l)((0,s.l)({},a.u),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),tA=(0,s.l)((0,s.l)({},a.x),{scheduledAt:null}),tU=function(e){function t(t){var n,r=this;r=e.call(this)||this;var i=[];t.mentionType===s.ah.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map(function(e){return e.userId})));var a=t.channelType,o=t.channelUrl,u=t.scheduledMessageId;return r.method=s.A.PUT,r.path="".concat((0,s.g)(a),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(u)),r.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:s.ar.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map(function(e){return s.as.payloadify(e)}):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map(function(e){return s.ai.payloadify(e)}),apple_critical_alert_options:s.ak.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption},r}return(0,s._)(t,e),t}(s.b),tI=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new s.F(t,n),r}return(0,s._)(t,e),t}(s.c),tw=function(e){function t(t){var n,r=this;r=e.call(this)||this;var i=[];t.mentionType===s.ah.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map(function(e){return e.userId})));var a=t.channelType,o=t.channelUrl,u=t.scheduledMessageId;return r.method=s.A.PUT,r.path="".concat((0,s.g)(a),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(u)),r.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:s.ar.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map(function(e){return s.ai.payloadify(e)}),apple_critical_alert_options:s.ak.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption},r}return(0,s._)(t,e),t}(s.b);tX=s.c,(0,s._)(function(e,t){var n=tX.call(this,e,t)||this;return n.message=new s.x(e,t),n},tX);var tk=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,i=t.channelUrl,a=t.scheduledMessageId;return n.method=s.A.DELETE,n.path="".concat((0,s.g)(r),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(a)),n}return(0,s._)(t,e),t}(s.b),tL=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,i=t.channelUrl,a=t.scheduledMessageId;return n.method=s.A.POST,n.path="".concat((0,s.g)(r),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(a),"/send_now"),n}return(0,s._)(t,e),t}(s.b),tD=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=t.pushTriggerOption,a=e.call(this)||this;return a.method=s.A.PUT,a.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),a.params={push_trigger_option:i},a}return(0,s._)(t,e),t}(s.b),tR=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return(0,s._)(t,e),t}(s.c),tP=function(e){function t(t){var n=t.userId,r=t.channelUrl,i=e.call(this)||this;return i.method=s.A.GET,i.path="".concat(s.N,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),i}return(0,s._)(t,e),t}(s.b),tO=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return(0,s._)(t,e),t}(s.c),tV=function(e){function t(t){var n=t.pollId,r=t.title,i=t.data,a=t.allowUserSuggestion,o=t.allowMultipleVotes,u=t.closeAt,l=e.call(this)||this;return l.method=s.A.PUT,l.path="".concat(s.a,"/").concat(encodeURIComponent(n)),l.params={title:r,data:i,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},l}return(0,s._)(t,e),t}(s.b),tF=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new s.P(t,n),r}return(0,s._)(t,e),t}(s.c),tx=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=s.A.DELETE,r.path="".concat(s.a,"/").concat(encodeURIComponent(n)),r}return(0,s._)(t,e),t}(s.b);t$=s.c,(0,s._)(function(){return null!==t$&&t$.apply(this,arguments)||this},t$);var tH=function(e){function t(t){var n=t.pollId,r=e.call(this)||this;return r.method=s.A.PUT,r.path="".concat(s.a,"/").concat(encodeURIComponent(n),"/close"),r}return(0,s._)(t,e),t}(s.b),tj=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new s.P(t,n),r}return(0,s._)(t,e),t}(s.c),tG=function(e){function t(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,a=t.optionText,o=e.call(this)||this;return o.method=s.A.POST,o.path="".concat(s.a,"/").concat(encodeURIComponent(i),"/options"),o.params={channel_url:n,channel_type:r,text:a},o}return(0,s._)(t,e),t}(s.b),tq=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new s.P(t,n),r}return(0,s._)(t,e),t}(s.c),tz=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,i=t.optionText,a=e.call(this)||this;return a.method=s.A.PUT,a.path="".concat(s.a,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),a.params={text:i},a}return(0,s._)(t,e),t}(s.b),tK=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.poll=new s.P(t,n),r}return(0,s._)(t,e),t}(s.c),tB=function(e){function t(t){var n=t.pollId,r=t.pollOptionId,i=e.call(this)||this;return i.method=s.A.DELETE,i.path="".concat(s.a,"/").concat(encodeURIComponent(n),"/options/").concat(encodeURIComponent(r)),i}return(0,s._)(t,e),t}(s.b);t0=s.c,(0,s._)(function(){return null!==t0&&t0.apply(this,arguments)||this},t0);var tY,tW,tQ,tJ,tZ,tX,t$,t0,t1,t2,t3,t4=function(e){function t(t){var n=t.reqId,r=t.channelType,i=t.channelUrl,a=t.pollId,o=t.pollOptionIds;return e.call(this,{code:"VOTE",ackRequired:!0,payload:(0,s.e)({req_id:n,channel_type:r===s.C.OPEN?"open_channels":"group_channels",channel_url:i,poll_id:a,option_ids:o})})||this}return(0,s._)(t,e),t}(s.an);(t6=t1||(t1={})).ALL="all",t6.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",t6.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",t6.OFF="off",(t7=t2||(t2={})).MUTED="muted",t7.UNMUTED="unmuted",(t5=t3||(t3={})).UNHIDDEN="unhidden",t5.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",t5.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide";var t6,t7,t5,t8,t9=function(e){function t(t,n){var r,a,o,u,c,h,d,_,p,f,m,v,y,E,C,b,N,M,S=this;return(S=e.call(this,t,n)||this)._unreadMemberStateMap=new Map,S._undeliveredMemberStateMap=new Map,S._typingStatus=new Map,S._lastMemberCountUpdated=0,S._typingStarted=0,S._typingEnded=0,S.isDistinct=!1,S.isSuper=!1,S.isBroadcast=!1,S.isExclusive=!1,S.isPublic=!1,S.isDiscoverable=!0,S.isAccessCodeRequired=!1,S.isPushEnabled=!1,S.unreadMessageCount=0,S.unreadMentionCount=0,S.members=[],S.memberCount=0,S.joinedMemberCount=0,S.hiddenState=t3.UNHIDDEN,S.lastMessage=null,S.messageOffsetTimestamp=0,S.messageSurvivalSeconds=-1,S.myMemberState=l.NONE,S.myRole=s.af.NONE,S.myMutedState=t2.UNMUTED,S.myLastRead=0,S.myCountPreference=t1.ALL,S.myPushTriggerOption=i.o.DEFAULT,S.inviter=null,S.invitedAt=0,S.joinedAt=0,S.channelType=s.C.GROUP,S.isDistinct=null!==(a=n.is_distinct)&&void 0!==a&&a,S.isSuper=null!==(o=n.is_super)&&void 0!==o&&o,S.isBroadcast=null!==(u=n.is_broadcast)&&void 0!==u&&u,S.isExclusive=null!==(c=n.is_exclusive)&&void 0!==c&&c,S.isPublic=null!==(h=n.is_public)&&void 0!==h&&h,S.isDiscoverable=null!==(d=n.is_discoverable)&&void 0!==d?d:S.isPublic,S.isAccessCodeRequired=null!==(_=n.is_access_code_required)&&void 0!==_&&_,S.isPushEnabled=null!==(p=n.is_push_enabled)&&void 0!==p&&p,Array.isArray(n.members)&&(r=S.members).push.apply(r,(0,s.Z)([],(0,s.Y)(n.members.map(function(e){return new g(S._iid,e)})),!1)),S.memberCount=null!==(f=n.member_count)&&void 0!==f?f:0,S.joinedMemberCount=null!==(m=n.joined_member_count)&&void 0!==m?m:0,S.hiddenState=(0,s.h)(t3,n.hidden_state)?n.hidden_state:t3.UNHIDDEN,S.messageOffsetTimestamp=null!==(v=n.ts_message_offset)&&void 0!==v?v:0,S.messageSurvivalSeconds=null!==(y=n.message_survival_seconds)&&void 0!==y?y:-1,S.lastMessage=n.last_message?(0,s.aX)(S._iid,(0,s.l)({channel_type:S.channelType},n.last_message)):null,n.read_receipt&&Object.keys(n.read_receipt).forEach(function(e){(0,s.i)("number",n.read_receipt[e])&&S._updateUnreadMemberState(e,n.read_receipt[e])}),n.delivery_receipt&&Object.keys(n.delivery_receipt).forEach(function(e){(0,s.i)("number",n.delivery_receipt[e])&&S._updateUndeliveredMemberState(e,n.delivery_receipt[e])}),S.myMemberState=(0,s.h)(l,n.member_state)?n.member_state:l.NONE,S.myRole=(0,s.h)(s.af,n.my_role)?n.my_role:s.af.NONE,(0,s.h)(t2,n.is_muted)?S.myMutedState=n.is_muted:(0,s.i)("boolean",n.is_muted)?S.myMutedState=n.is_muted?t2.MUTED:t2.UNMUTED:S.myMutedState=t2.UNMUTED,S.myCountPreference=(0,s.h)(t1,n.count_preference)?n.count_preference:t1.ALL,S.myPushTriggerOption=(0,s.h)(i.o,n.push_trigger_option)?n.push_trigger_option:i.o.ALL,S.myLastRead=null!==(E=n.user_last_read)&&void 0!==E?E:0,S.inviter=n.inviter?new s.U(S._iid,n.inviter):null,S.invitedAt=null!==(C=n.invited_at)&&void 0!==C?C:0,S.joinedAt=null!==(b=n.joined_ts)&&void 0!==b?b:0,S._updateUnreadCount(null!==(N=n.unread_message_count)&&void 0!==N?N:0,null!==(M=n.unread_mention_count)&&void 0!==M?M:0),S}return(0,s._)(t,e),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.hiddenState!==t3.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return Object.keys(this._typingStatus).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=(0,s.z)(this._unreadMemberStateMap),i=r.next();!i.done;i=r.next()){var a=(0,s.Y)(i.value,2),o=a[0],u=a[1];n[o]=u}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=(0,s.z)(this._undeliveredMemberStateMap),i=r.next();!i.done;i=r.next()){var a=(0,s.Y)(i.value,2),o=a[0],u=a[1];n[o]=u}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),t.payloadify=function(t){return t?(0,s.e)((0,s.l)((0,s.l)({},e.payloadify.call(this,t)),{is_access_code_required:t.isAccessCodeRequired,is_distinct:t.isDistinct,is_super:t.isSuper,is_broadcast:t.isBroadcast,is_exclusive:t.isExclusive,is_public:t.isPublic,is_discoverable:t.isDiscoverable,is_muted:t.myMutedState,is_push_enabled:t.isPushEnabled,unread_message_count:t.unreadMessageCount,unread_mention_count:t.unreadMentionCount,push_trigger_option:t.myPushTriggerOption,count_preference:t.myCountPreference,hidden_state:t.hiddenState,member_count:t.memberCount,joined_member_count:t.joinedMemberCount,member_state:t.myMemberState,my_role:t.myRole,user_last_read:t.myLastRead,ts_message_offset:t.messageOffsetTimestamp,message_survival_seconds:t.messageSurvivalSeconds,read_receipt:t.cachedUnreadMemberState,delivery_receipt:t.cachedUndeliveredMemberState,members:t.members.map(function(e){return g.payloadify(e)}),last_message:(0,s.a_)(t.lastMessage),inviter:t.inviter?s.U.payloadify(t.inviter):null,invited_at:t.invitedAt,joined_ts:t.joinedAt})):null},t.prototype._shouldUpdateLastMessageWith=function(e){return!(e instanceof s.w&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)},t.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0){if(this.myCountPreference===t1.ALL||this.myCountPreference===t1.UNREAD_MESSAGE_COUNT_ONLY){if(this.isExclusive||this.isSuper||this.isBroadcast){var n=s.V.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e}else this.unreadMessageCount=0}else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===t1.ALL||this.myCountPreference===t1.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},t.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),s.V.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},t.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);(!n||n<t)&&this._undeliveredMemberStateMap.set(e,t)},t.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus[e.userId]={user:e,ts:t}:delete this._typingStatus[e.userId]},t.prototype._invalidateTypingStatus=function(){var e=(new Date).getTime(),t=!1;for(var n in this._typingStatus)e-this._typingStatus[n].ts>=1e4&&(delete this._typingStatus[n],t=!0);return t},t.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},t.prototype.isReadMessage=function(e){var t=s.V.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt},t.prototype.serialize=function(){var e=this;return(0,s.aT)(this,function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState})},t.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new tc(this._iid,(0,s.l)({channel:this},e))},t.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new tf(this._iid,this.url,e)},t.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex(function(t){return t.userId===e.userId});if(n>-1){var r=this.members[n];r.state===l.JOINED&&(e.state=r.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},t.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=this.members.findIndex(function(t){return t.userId===e.userId});if(t>-1)return this.members.splice(t,1),this.memberCount--,!0}return!1},t.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof s.w&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=s.V.of(this._iid).sdkState,i=e.createdAt,a=0;try{for(var o=(0,s.z)(this.members),u=o.next();!u.done;u=o.next()){var c=u.value;r.userId!==c.userId&&c.state===l.JOINED&&e.sender.userId!==c.userId&&(this.cachedUnreadMemberState[c.userId]||0)<i&&a++}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a}return 0},t.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof s.w&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=s.V.of(this._iid).sdkState,i=e.createdAt,a=0;try{for(var o=(0,s.z)(this.members),u=o.next();!u.done;u=o.next()){var c=u.value;r.userId!==c.userId&&c.state===l.JOINED&&e.sender.userId!==c.userId&&(this.cachedUndeliveredMemberState[c.userId]||0)<i&&a++}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a}return 0},t.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=s.V.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=e instanceof s.w?e.sender:null,a=[];return this.members.forEach(function(s){(t||s.userId!==r.userId&&s.userId!==(null==i?void 0:i.userId))&&n._unreadMemberStateMap.get(s.userId)>=e.createdAt&&a.push(s)}),a},t.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=s.V.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var i=e instanceof s.w?e.sender:null,a=[];return this.members.forEach(function(s){(t||s.userId!==r.userId&&s.userId!==(null==i?void 0:i.userId))&&n._unreadMemberStateMap.get(s.userId)<e.createdAt&&a.push(s)}),a},t.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=s.V.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach(function(s){if(e||s.userId!==n.userId){var i=t._unreadMemberStateMap.get(s.userId);r[s.userId]=new y(t._iid,{channel_url:t.url,channel_type:t.channelType,user:g.payloadify(s),ts:i})}}),r},t.prototype.getTypingUsers=function(){var e=[];for(var t in this._typingStatus){var n=this._typingStatus[t].user;e.push(n)}return e},t.prototype.invalidateTypingStatus=function(){var e=s.V.of(this._iid).typingIndicatorInvalidateTime,t=(new Date).getTime(),n=!1;for(var r in this._typingStatus)t-this._typingStatus[r].ts>=e&&(delete this._typingStatus[r],n=!0);return n},t.prototype.refresh=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).requestQueue,n=e.dispatcher,r=new Q({channelUrl:this.url}),[4,t.send(r)];case 1:return i=a.sent().as(J).channel,n.dispatch(new q({channels:[i],source:F.REQUEST_CHANNEL})),[2,i]}})})},t.prototype.freeze=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,e.prototype.freeze.call(this)];case 1:return t.sent(),s.V.of(this._iid).dispatcher.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_HIDDEN})),[2]}})})},t.prototype.unfreeze=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,e.prototype.unfreeze.call(this)];case 1:return t.sent(),s.V.of(this._iid).dispatcher.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_UNHIDDEN})),[2]}})})},t.prototype.updateChannel=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return t=(0,s.l)((0,s.l)({},th),e),(0,s.u)((0,s.i)("string",t.coverUrl,!0)&&((0,s.q)(t.coverImage)||(0,s.i)("string",t.coverImage)||null===t.coverImage)&&(0,s.i)("boolean",t.isDistinct,!0)&&(0,s.i)("boolean",t.isPublic,!0)&&(0,s.i)("boolean",t.isDiscoverable,!0)&&(0,s.i)("string",t.accessCode,!0)&&(0,s.i)("string",t.name,!0)&&(0,s.i)("string",t.data,!0)&&(0,s.i)("string",t.customType,!0)&&(0,s.T)("string",t.operatorUserIds,!0)&&(0,s.i)("number",t.messageSurvivalSeconds,!0)).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).dispatcher,i=n.requestQueue,a=new tg((0,s.l)({channelUrl:this.url},t)),[4,i.send(a)];case 1:return o=u.sent().as(ty).channel,r.dispatch(new q({channels:[o],source:F.EVENT_CHANNEL_UPDATED})),[2,o]}})})},t.prototype.invite=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){return(0,s.u)(e.every(function(e){return e instanceof s.U})).throw(s.S.invalidParameters),[2,this.inviteWithUserIds(e.map(function(e){return e.userId}))]})})},t.prototype.inviteWithUserIds=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a;return(0,s.k)(this,function(o){switch(o.label){case 0:return(0,s.u)((0,s.T)("string",e)).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.requestQueue,i=new eg({channelUrl:this.url,userIds:e}),[4,r.send(i)];case 1:return a=o.sent().as(ey).channel,n.dispatch(new q({channels:[a],source:F.EVENT_CHANNEL_INVITED})),[2,a]}})})},t.prototype.join=function(e){return void 0===e&&(e=null),(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return(0,s.u)((0,s.i)("string",e)||null===e).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.sdkState,i=t.requestQueue,a=new e_({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,i.send(a)];case 1:return(o=u.sent().as(ep).channel).myMemberState=l.JOINED,n.dispatch(new q({channels:[o],source:F.EVENT_CHANNEL_JOINED})),[2,this]}})})},t.prototype.leave=function(e){return void 0===e&&(e=!1),(0,s.j)(this,void 0,void 0,function(){var t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return n=(t=s.V.of(this._iid)).sdkState,r=t.requestQueue,i=new em({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,r.send(i)];case 1:return a.sent(),[2]}})})},t.prototype.acceptInvitation=function(e){return void 0===e&&(e=null),(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return(0,s.u)((0,s.i)("string",e)||null===e).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.sdkState,i=t.requestQueue,a=new tm({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,i.send(a)];case 1:return(o=u.sent().as(tv).channel).myMemberState=l.JOINED,n.dispatch(new q({channels:[o],source:F.EVENT_CHANNEL_ACCEPTED_INVITE})),[2,o]}})})},t.prototype.declineInvitation=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new eC({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return(i=a.sent().as(eb).channel).myMemberState=l.NONE,[2,i]}})})},t.prototype.sendUserMessage=function(t){var n=this,r=new s.ay,a=s.V.of(this._iid).dispatcher,o=i.j.of(this._iid);return e.prototype.sendUserMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){t&&o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){var t=eB.of(n._iid);o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),t.handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new q({channels:[n],source:F.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.updateUserMessage=function(t,n){return(0,s.j)(this,void 0,void 0,function(){var r,i,a,o=this;return(0,s.k)(this,function(u){switch(u.label){case 0:return r=s.V.of(this._iid).dispatcher,[4,e.prototype.updateUserMessage.call(this,t,n)];case 1:return i=u.sent(),a=!1,!i.silent&&this._shouldUpdateLastMessageWith(i)&&(this.lastMessage=i,a=!0),a&&(eB.of(this._iid).handlers.map(function(e){return e.onChannelChanged(o)}),r.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_UPDATED}))),r.dispatch(new s.L({messages:[i],source:s.M.EVENT_MESSAGE_UPDATED})),[2,i]}})})},t.prototype._autoResendUserMessage=function(t){var n=this,r=new s.ay,a=s.V.of(this._iid).dispatcher,o=i.j.of(this._iid);return e.prototype._autoResendUserMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){var t=eB.of(n._iid);o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),t.handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new q({channels:[n],source:F.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.sendFileMessage=function(t){var n=this,r=new s.ay,a=s.V.of(this._iid).dispatcher,o=i.j.of(this._iid);return e.prototype.sendFileMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){t&&o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){var t=eB.of(n._iid);o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),t.handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new q({channels:[n],source:F.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.updateFileMessage=function(t,n){return(0,s.j)(this,void 0,void 0,function(){var r,i,a,o=this;return(0,s.k)(this,function(u){switch(u.label){case 0:return r=s.V.of(this._iid).dispatcher,[4,e.prototype.updateFileMessage.call(this,t,n)];case 1:return i=u.sent(),a=!1,!i.silent&&this._shouldUpdateLastMessageWith(i)&&(this.lastMessage=i,a=!0),a&&(eB.of(this._iid).handlers.map(function(e){return e.onChannelChanged(o)}),r.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_UPDATED}))),r.dispatch(new s.L({messages:[i],source:s.M.EVENT_MESSAGE_UPDATED})),[2,i]}})})},t.prototype._autoResendFileMessage=function(t){var n=this,r=new s.ay,a=s.V.of(this._iid).dispatcher,o=i.j.of(this._iid);return e.prototype._autoResendFileMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){var t=eB.of(n._iid);o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),t.handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new q({channels:[n],source:F.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.deleteMessage=function(t){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(n){switch(n.label){case 0:return[4,e.prototype.deleteMessage.call(this,t)];case 1:return n.sent(),0===t.messageId&&t instanceof s.w&&s.V.of(this._iid).dispatcher.dispatch(new s.aM({reqId:t.reqId,source:s.M.EVENT_MESSAGE_DELETED})),[2]}})})},t.prototype.hide=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a,o,u;return(0,s.k)(this,function(l){switch(l.label){case 0:var c;return t=(0,s.l)((0,s.l)({},td),e),(0,s.u)((c=t,(0,s.i)("boolean",c.hidePreviousMessages)&&(0,s.i)("boolean",c.allowAutoUnhide))).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).dispatcher,i=n.sdkState,a=n.requestQueue,o=new eD((0,s.l)({channelUrl:this.url,userId:i.userId},t)),[4,a.send(o)];case 1:return u=l.sent().as(eR).messageOffsetTimestamp,this.hiddenState=t.allowAutoUnhide?t3.HIDDEN_ALLOW_AUTO_UNHIDE:t3.HIDDEN_PREVENT_AUTO_UNHIDE,t.hidePreviousMessages&&this._updateUnreadCount(0,0),u&&(this.messageOffsetTimestamp=u),r.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_HIDDEN})),[2,this]}})})},t.prototype.unhide=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=(e=s.V.of(this._iid)).dispatcher,n=e.requestQueue,r=new tC({channelUrl:this.url}),[4,n.send(r)];case 1:return i.sent(),this.hiddenState=t3.UNHIDDEN,t.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_UNHIDDEN})),[2,this]}})})},t.prototype.delete=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t;return(0,s.k)(this,function(n){switch(n.label){case 0:return e=s.V.of(this._iid).requestQueue,t=new tE({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}})})},t.prototype.markAsRead=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i,a,o=this;return(0,s.k)(this,function(u){switch(u.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.dispatcher,r=e.requestQueue,i=new eM({channelUrl:this.url}),[4,r.send(i)];case 1:return a=u.sent().as(eS).readStatus,this._updateUnreadMemberState(t.userId,a.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),eB.of(this._iid).handlers.map(function(e){return e.onChannelChanged(o)})),n.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_READ})),[2]}})})},t.prototype.markAsDelivered=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new eT({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.startTyping=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){return t=(e=s.V.of(this._iid)).requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n&&(this._typingStarted=r,this._typingEnded=0,i=new eO({channelUrl:this.url,time:this._typingStarted}),t.send(i)),[2]})})},t.prototype.endTyping=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){return t=(e=s.V.of(this._iid)).requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n&&(this._typingStarted=0,this._typingEnded=r,i=new eF({channelUrl:this.url,time:this._typingStarted}),t.send(i)),[2]})})},t.prototype.createScheduledUserMessage=function(e){e=(0,s.l)((0,s.l)({},i.S),e),(0,s.u)((0,i.v)(e)).throw(s.S.invalidParameters);var t=new s.ay;return this._createScheduledUserMessage(e,t),t},t.prototype.updateScheduledUserMessage=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n,r,i;return(0,s.k)(this,function(o){switch(o.label){case 0:return n=(0,s.l)((0,s.l)({},tA),t),(0,s.u)((0,a.y)(n)&&(0,s.i)("number",n.scheduledAt,!0)).throw(s.S.invalidParameters),r=s.V.of(this._iid).requestQueue,i=new tw((0,s.l)({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,r.send(i)];case 1:return[2,o.sent().as(a.C).message]}})})},t.prototype.createScheduledFileMessage=function(e){var t=this;e=(0,s.l)((0,s.l)({},i.k),e),(0,s.u)((0,i.l)(e)).throw(s.S.invalidParameters);var n=Date.now(),r=this._generateRequestId(),o=new s.ay;return(0,s.aw)(a.P).then(function(){var i=t._createPendingScheduledFileMessage(e,r,n);(0,s.a6)(function(){return(0,s.j)(t,void 0,void 0,function(){return(0,s.k)(this,function(e){return[2,o._trigger(null,i)]})})})}),(0,s.q)(e.file)?this._uploadFileAndUpdateParams(e).then(function(){return t._createScheduledFileMessage(e,o,r,n)}):this._createScheduledFileMessage(e,o,r,n),o},t.prototype.updateScheduledFileMessage=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:var o;return n=(0,s.l)((0,s.l)({},tT),t),(0,s.u)((o=n,(0,a.w)(o)&&(0,s.i)("number",o.scheduledAt,!0)&&((0,s.q)(o.file)||(0,s.i)("string",o.fileUrl))&&(0,s.i)("string",o.fileName,!0)&&(0,s.i)("string",o.mimeType,!0)&&(0,s.i)("number",o.fileSize,!0)&&(null===o.thumbnailSizes||o.thumbnailSizes.every(function(e){return(0,s.i)("object",e)&&e.maxWidth>0&&e.maxHeight>0})))).throw(s.S.invalidParameters),(0,s.q)(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r=new tU((0,s.l)({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,s.V.of(this._iid).requestQueue.send(r)];case 3:return[2,i.sent().as(tI).message]}})})},t.prototype.cancelScheduledMessage=function(e){return(0,s.j)(this,void 0,void 0,function(){var t;return(0,s.k)(this,function(n){switch(n.label){case 0:return t=new tk({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,s.V.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}})})},t.prototype.sendScheduledMessageNow=function(e){return(0,s.j)(this,void 0,void 0,function(){var t;return(0,s.k)(this,function(n){switch(n.label){case 0:return t=new tL({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,s.V.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}})})},t.prototype.getMyPushTriggerOption=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new tP({userId:t.userId,channelUrl:this.url}),[4,n.send(r)];case 1:return i=a.sent().as(tO).pushTriggerOption,this.myPushTriggerOption=i,[2,i]}})})},t.prototype.setMyPushTriggerOption=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return(0,s.u)((0,s.h)(i.o,e)).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).sdkState,r=t.requestQueue,a=new tD({userId:n.userId,channelUrl:this.url,pushTriggerOption:e}),[4,r.send(a)];case 1:return o=u.sent().as(tR).pushTriggerOption,this.myPushTriggerOption=o,[2,o]}})})},t.prototype.setMyCountPreference=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return(0,s.u)((0,s.h)(t1,e)).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.sdkState,i=t.requestQueue,a=new tb({channelUrl:this.url,userId:r.userId,countPreference:e}),[4,i.send(a)];case 1:return o=u.sent().as(tN).countPreference,this.myCountPreference=o,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),n.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_CREATED})),[2,o]}})})},t.prototype.resetMyHistory=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).dispatcher,n=e.requestQueue,r=new tM({channelUrl:this.url}),[4,n.send(r)];case 1:return i=a.sent().as(tS).messageOffsetTimestamp,this.messageOffsetTimestamp=i,t.dispatch(new q({channels:[this],source:F.EVENT_CHANNEL_RESET_HISTORY})),[2,this]}})})},t.prototype.updatePoll=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return(0,s.u)((0,s.i)("number",e)&&(0,s.i)("string",t.title,!0)&&(0,s.f)(t.data)&&(0,s.i)("boolean",t.allowUserSuggestion,!0)&&(0,s.i)("boolean",t.allowMultipleVotes,!0)&&(0,s.i)("number",t.closeAt,!0)).throw(s.S.invalidParameters),n=s.V.of(this._iid).requestQueue,r=new tV((0,s.l)({pollId:e},t)),[4,n.send(r)];case 1:return[2,i.sent().as(tF).poll]}})})},t.prototype.deletePoll=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=(0,s.i)("number",e),(0,s.u)(t).throw(s.S.invalidParameters),n=s.V.of(this._iid).requestQueue,r=new tx({pollId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.closePoll=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return t=(0,s.i)("number",e),(0,s.u)(t).throw(s.S.invalidParameters),n=s.V.of(this._iid).requestQueue,r=new tH({pollId:e}),[4,n.send(r)];case 1:return[2,i.sent().as(tj).poll]}})})},t.prototype.addPollOption=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return n=(0,s.i)("number",e)&&(0,s.i)("string",t)&&""!==t.trim(),(0,s.u)(n).throw(s.S.invalidParameters),r=s.V.of(this._iid).requestQueue,i=new tG({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,r.send(i)];case 1:return[2,a.sent().as(tq).poll]}})})},t.prototype.updatePollOption=function(e,t,n){return(0,s.j)(this,void 0,void 0,function(){var r,i,a;return(0,s.k)(this,function(o){switch(o.label){case 0:return r=(0,s.i)("number",e)&&(0,s.i)("number",t)&&(0,s.i)("string",n)&&""!==n.trim(),(0,s.u)(r).throw(s.S.invalidParameters),i=s.V.of(this._iid).requestQueue,a=new tz({pollId:e,pollOptionId:t,optionText:n}),[4,i.send(a)];case 1:return[2,o.sent().as(tK).poll]}})})},t.prototype.deletePollOption=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return n=(0,s.i)("number",e)&&(0,s.i)("number",t),(0,s.u)(n).throw(s.S.invalidParameters),r=s.V.of(this._iid).requestQueue,i=new tB({pollId:e,pollOptionId:t}),[4,r.send(i)];case 1:return a.sent(),[2]}})})},t.prototype.votePoll=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n,r,i,a,o,u;return(0,s.k)(this,function(l){switch(l.label){case 0:return n=(0,s.i)("number",e)&&(0,s.T)("number",t),(0,s.u)(n).throw(s.S.invalidParameters),i=(r=s.V.of(this._iid)).requestQueue,a=r.dispatcher,o=new t4({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:t}),[4,i.send(o)];case 1:return u=l.sent().as(eG).event,a.dispatch(new s.aK({event:u,source:s.M.EVENT_POLL_VOTED})),[2,u]}})})},t.prototype.getPollChangeLogsSinceTimestamp=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return(0,s.u)((0,s.i)("number",e)).throw(s.S.invalidParameters),[4,i.h.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}})})},t.prototype.getPollChangeLogsSinceToken=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return(0,s.u)((0,s.i)("string",e,!0)),[4,i.h.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,t.sent()]}})})},t.prototype.createPollListQuery=function(e){return void 0===e&&(e=i.p),new i.m(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},t.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=i.q),new i.n(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},t.prototype._uploadFileAndUpdateParams=function(e){return(0,s.j)(this,void 0,void 0,function(){var t,n,r,i,a,o,u,l,c,h;return(0,s.k)(this,function(d){switch(d.label){case 0:return(0,s.q)(e.file)?(t=s.V.of(this._iid).requestQueue,n=new s.b0({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:i=(r=d.sent().as(s.a$)).url,o=void 0===(a=r.fileSize)?e.fileSize:a,l=void 0===(u=r.thumbnailSizes)?e.thumbnailSizes:u,h=void 0!==(c=r.requireAuth)&&c,e.fileUrl=i,e.fileSize=o,e.thumbnailSizes=l,e.requireAuth=h,d.label=2;case 2:return[2]}})})},t}(a.e),ne={},nt=function(){function e(e){var t,n=e._iid,r=this;this._sync=null,this._metadata=null,this._iid=n;var a,o=s.V.of(this._iid),u=o.sdkState,l=o.logger;this._metadataKey=(a=u.userId,"sendbird:".concat(a,"@groupchannel/sync.meta"));var c=(t=u.userId,"sendbird:".concat(t,"@groupchannel/sync"));this._sync=new e$(c,function(){return(0,s.j)(r,void 0,void 0,function(){var e,t,n,r,a,o;return(0,s.k)(this,function(u){switch(u.label){case 0:return e={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:if(u.sent(),l.debug("channel background sync from",this._metadata.token),this._metadata.completed)return[3,9];u.label=2;case 2:return u.trys.push([2,5,,8]),[4,eB.of(this._iid).getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:i.G.CHRONOLOGICAL},100,F.SYNC_CHANNEL_BACKGROUND)];case 3:return n=(t=u.sent()).channels,r=t.token,e.hasNext=n.length>=100&&!!r,e.nextToken=r,this._metadata.token=r,(o=this._metadata.range).extends.apply(o,(0,s.Z)([],(0,s.Y)(n.map(function(e){return e.createdAt})),!1)),this._metadata.completed=!e.hasNext,l.debug("channel background sync progress",e),[4,this.saveMetadata()];case 4:return u.sent(),[3,8];case 5:return a=u.sent(),l.debug("channel background sync error",a),a instanceof s.S&&a.isInvalidTokenError?[4,this.clearMetaData()]:[3,7];case 6:u.sent(),u.label=7;case 7:throw a;case 8:return[3,10];case 9:e.hasNext=!1,e.nextToken="",u.label=10;case 10:return[2,e]}})})})}return e.of=function(t){if(!ne[t]){var n=ne[t]=new e({_iid:t});s.V.of(t).dispatcher.on(function(e){e instanceof s.H&&(e.stateType===s.J.CONNECTED?n.resume():n.pause())})}return ne[t]},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)},enumerable:!1,configurable:!0}),e.prototype.loadMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){var e;return(0,s.k)(this,function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,s.V.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:"",range:new ez(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!e&&e.completed},t.label=2;case 2:return[2]}})})},e.prototype.saveMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.clearMetaData=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){var e,t;s.V.of(this._iid).logger.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:"")},e.prototype.pause=function(){s.V.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},e}(),nn={},nr=function(){function e(e){var t,n=e._iid,r=this;this._sync=null,this._metadataKey=null,this._metadata=null,this._iid=n;var i,a=s.V.of(this._iid),o=a.logger,u=a.sdkState;this._metadataKey=(i=u.userId,"sendbird:".concat(i,"@groupchannel/changelogs.meta"));var l=(t=u.userId,"sendbird:".concat(t,"@groupchannel/changelogs"));this._sync=new e$(l,function(){return(0,s.j)(r,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:a.sent(),o.debug("channel changelog sync from",this._metadata.token),a.label=2;case 2:return a.trys.push([2,5,,8]),[4,eB.of(this._iid).getMyGroupChannelChangeLogs(this._metadata.token,{},F.SYNC_CHANNEL_CHANGELOGS)];case 3:return n=(t=a.sent()).hasMore,r=t.token,e.hasNext=n,e.nextToken=r,this._metadata.token=r,o.debug("channel changelog sync progress",e),[4,this.saveMetadata()];case 4:return a.sent(),[3,8];case 5:return i=a.sent(),o.debug("channel changelog sync error",i),i instanceof s.S&&i.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:a.sent(),a.label=7;case 7:throw i;case 8:return[2,e]}})})})}return e.of=function(t){if(!nn[t]){var n=nn[t]=new e({_iid:t});s.V.of(t).dispatcher.on(function(e){e instanceof s.H&&(e.stateType===s.J.CONNECTED?n.resume():n.pause())})}return nn[t]},e.prototype.loadMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.k)(this,function(i){switch(i.label){case 0:return this._metadata?[3,2]:(t=(e=s.V.of(this._iid)).cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=i.sent(),this._metadata={token:r?r.token:n/1e3},i.label=2;case 2:return[2]}})})},e.prototype.saveMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.clearMetadata=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){this._sync.start(0)},e.prototype.pause=function(){this._sync.stop()},e}(),ns=function(){function e(e,t){var n=t.filter,r=t.order,a=t.limit,o=this;this.channels=[],this._iid=e,this._key="gcc-".concat((0,s.ab)()),this.filter=null!=n?n:new I,this.order=null!=r?r:i.G.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=a?a:i.D;var u=s.V.of(this._iid),l=u.sdkState;u.cacheContext.localCacheEnabled&&nt.of(e).resume(),nr.of(e).resume(),eB.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e.filter(function(e){return o.filter.match(e,l.userId)}),r=e.filter(function(e){return!o.filter.match(e,l.userId)}).map(function(e){return e.url});n.length>0&&o._addChannelsToView(n,t),r.length>0&&o._removeChannelsFromView(r,t)},onRemove:function(e,t){o._removeChannelsFromView(e,t)}})}return Object.defineProperty(e.prototype,"hasMore",{get:function(){return this._hasMore},enumerable:!1,configurable:!0}),e.prototype.setGroupChannelCollectionHandler=function(e){this._handler=e},e.prototype._addChannelsToView=function(e,t,n){var r,i,a=this;void 0===n&&(n=!1);var o=[],u=[];try{for(var l=(0,s.z)(e),c=l.next();!c.done;c=l.next()){var h=c.value,d=e9(this.channels,h,this.order),_=d.place;if(d.contains)switch(u.push(h),t){case F.EVENT_CHANNEL_UPDATED:case F.EVENT_MESSAGE_RECEIVED:this.channels.splice(_,1);var p=e9(this.channels,h,this.order).place;this.channels.splice(p,0,h);break;default:this.channels[_]=h}else if(_===this.channels.length){var f=nt.of(this._iid);(n||f.completed)&&(o.push(h),this.channels.push(h))}else o.push(h),this.channels.splice(_,0,h)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}G(t)&&(0,s.a6)(function(){return(0,s.j)(a,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e0(t),o.length>0&&this._handler.onChannelsAdded(e,o),u.length>0&&this._handler.onChannelsUpdated(e,u),[2]})})})},e.prototype._removeChannelsFromView=function(e,t){var n,r,i=this,a=[],o=function(e){var t=u.channels.findIndex(function(t){return t.url===e});t>=0&&(a.push(u.channels[t].url),u.channels.splice(t,1))},u=this;try{for(var l=(0,s.z)(e),c=l.next();!c.done;c=l.next())o(c.value)}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return G(t)&&a.length>0&&(0,s.a6)(function(){return(0,s.j)(i,void 0,void 0,function(){var e;return(0,s.k)(this,function(n){return e=new e0(t),this._handler.onChannelsDeleted(e,a),[2]})})}),a},e.prototype._getLocalChannels=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,eB.of(this._iid).getChannelsFromCache(this._token,this.filter,this.order)];case 1:return[2,e.sent()]}})})},e.prototype._getRemoteChannels=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n;return(0,s.k)(this,function(r){switch(r.label){case 0:return[4,eB.of(this._iid).getMyGroupChannels(this._token,(0,s.l)((0,s.l)({},this.filter),{order:this.order}),this._limit)];case 1:return t=(e=r.sent()).channels,n=e.token,this._token=n,this._hasMore=!!n,[2,t]}})})},e.prototype.loadMore=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t=this;return(0,s.k)(this,function(n){switch(n.label){case 0:return this._hasMore?(e=[],[4,(0,s.aJ)(function(){return(0,s.j)(t,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._getLocalChannels()];case 1:return e=t.sent(),[2]}})})})]):[3,3];case 1:return n.sent(),[4,(0,s.aJ)(function(){return(0,s.j)(t,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._getRemoteChannels()];case 1:return e=t.sent(),[2]}})})})];case 2:return n.sent(),this._addChannelsToView(e,F.REQUEST_CHANNEL,!0),[2,e];case 3:return[2,[]]}})})},e.prototype.dispose=function(){s.V.of(this._iid).cacheContext.localCacheEnabled&&nt.of(this._iid).pause(),nr.of(this._iid).pause(),eB.of(this._iid).unsubscribeGroupChannelEvent(this._key)},e}(),ni=function(e){function t(t){var n=this,r=t.token,i=t.limit,a=t.order,o=t.includeEmpty,u=t.membershipFilter,l=t.channelNameContainsFilter,h=t.channelUrlsFilter,d=t.customTypesFilter,_=t.customTypeStartsWithFilter,p=t.superChannelFilter,f=t.metadataOrderKeyFilter,m=t.metadataKey,v=t.metadataValues,g=t.metadataValueStartsWith,y=t.includeFrozen,E=t.includeMetaData;return(n=e.call(this)||this).method=s.A.GET,n.path=s.aP,n.params=(0,s.e)({token:r,limit:i,order:a,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:o,public_mode:c.PUBLIC,public_membership_mode:u,name_contains:l,channel_urls:h,custom_types:d,custom_type_startswith:_,super_mode:p,metadata_order_key:f,metadata_key:m,metadata_values:v,metadata_value_startswith:g,show_frozen:y,show_metadata:E}),n}return(0,s._)(t,e),t}(s.b),na=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,i=n.channels,a=n.ts;return r.token=s,i&&i.length>0&&(r.channels=i.map(function(e){return e.ts=a,new t9(t,e)})),r.ts="number"==typeof a?a:null,r}return(0,s._)(t,e),t}(s.c);(r=t8||(t8={})).ALL="all",r.JOINED="joined";var no=function(e){function t(t,n){var r,s,a,o,u,l,c,h,_,p,f,m,v,g,y=this;return(y=e.call(this,t,n)||this).includeEmpty=!1,y.includeFrozen=!0,y.includeMetaData=!0,y.channelUrlsFilter=null,y.customTypesFilter=null,y.customTypeStartsWithFilter=null,y.channelNameContainsFilter=null,y.membershipFilter=t8.ALL,y.superChannelFilter=d.ALL,y.metadataKey=null,y.metadataValues=null,y.metadataOrderKeyFilter=null,y.metadataValueStartsWith=null,y.order=i.r.CHRONOLOGICAL,y.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,y.includeFrozen=null===(s=n.includeFrozen)||void 0===s||s,y.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,y.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,y.customTypesFilter=null!==(u=n.customTypesFilter)&&void 0!==u?u:null,y.customTypeStartsWithFilter=null!==(l=n.customTypeStartsWithFilter)&&void 0!==l?l:null,y.channelNameContainsFilter=null!==(c=n.channelNameContainsFilter)&&void 0!==c?c:null,y.membershipFilter=null!==(h=n.membershipFilter)&&void 0!==h?h:t8.ALL,y.superChannelFilter=null!==(_=n.superChannelFilter)&&void 0!==_?_:d.ALL,y.metadataKey=null!==(p=n.metadataKey)&&void 0!==p?p:null,y.metadataValues=null!==(f=n.metadataValues)&&void 0!==f?f:null,y.metadataOrderKeyFilter=null!==(m=n.metadataOrderKeyFilter)&&void 0!==m?m:null,y.metadataValueStartsWith=null!==(v=n.metadataValueStartsWith)&&void 0!==v?v:null,y.order=null!==(g=n.order)&&void 0!==g?g:i.r.CHRONOLOGICAL,y}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.i)("boolean",this.includeEmpty)&&(0,s.i)("boolean",this.includeFrozen)&&(0,s.i)("boolean",this.includeMetaData)&&(0,s.i)("string",this.channelNameContainsFilter,!0)&&(0,s.T)("string",this.channelUrlsFilter,!0)&&(0,s.T)("string",this.customTypesFilter,!0)&&(0,s.i)("string",this.customTypeStartsWithFilter,!0)&&(0,s.h)(t8,this.membershipFilter)&&(0,s.h)(d,this.superChannelFilter)&&(0,s.h)(i.r,this.order)&&(0,s.i)("string",this.metadataOrderKeyFilter,!0)&&(0,s.i)("string",this.metadataKey,!0)&&(0,s.T)("string",this.metadataValues,!0)&&(0,s.i)("string",this.metadataValueStartsWith,!0)},t.prototype.next=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u;return(0,s.k)(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,n=(t=s.V.of(this._iid)).requestQueue,r=t.dispatcher,i=new ni((0,s.l)((0,s.l)({},this),{token:this._token})),[4,n.send(i)]):[3,2]):[3,5];case 1:return o=(a=l.sent().as(na)).channels,u=a.token,this._token=u,this._hasNext=!!u,r.dispatch(new q({channels:o,source:F.REQUEST_CHANNEL})),this._isLoading=!1,[2,o];case 2:return[2,e];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.X),nu=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&(n[e]=t[e])}),n}return(0,s._)(t,e),t}(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUserJoined=s.r,t.onUserLeft=s.r,t.onUserReceivedInvitation=s.r,t.onUserDeclinedInvitation=s.r,t.onChannelHidden=s.r,t.onUnreadMemberStatusUpdated=s.r,t.onUndeliveredMemberStatusUpdated=s.r,t.onTypingStatusUpdated=s.r,t.onPollUpdated=s.r,t.onPollVoted=s.r,t.onPollDeleted=s.r,t}return(0,s._)(t,e),t}(o.B)),nl=function(e){function t(t){var n=this,r=t.token,i=t.limit,a=t.order,o=t.reverse,u=t.channelUrl,l=t.messageTypeFilter,c=t.scheduledStatus;return(n=e.call(this)||this).method=s.A.GET,n.path="".concat(s.aQ),n.params=(0,s.e)({limit:i,reverse:o,channel_url:u,order:a,status:c}),r&&(n.params.token=r),l&&(n.params.message_type=l),n}return(0,s._)(t,e),t}(s.b),nc=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.scheduledMessages=[];var i=n.next,a=n.scheduled_messages;return r.token=i,r.scheduledMessages=a.map(function(e){return(0,s.aX)(t,e)}),r}return(0,s._)(t,e),t}(s.c),nh=function(e){function t(t,n){var r,i,a,o,u,l=this;return(l=e.call(this,t,n)||this).channelUrl=null,l.order=null,l.reverse=!1,l.scheduledStatus=null,l.messageTypeFilter=s.s.ALL,l.channelUrl=null!==(r=n.channelUrl)&&void 0!==r?r:null,l.order=null!==(i=n.order)&&void 0!==i?i:null,l.reverse=null!==(a=n.reverse)&&void 0!==a&&a,l.scheduledStatus=null!==(o=n.scheduledStatus)&&void 0!==o?o:null,l.messageTypeFilter=null!==(u=n.messageTypeFilter)&&void 0!==u?u:s.s.ALL,l}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.i)("string",this.channelUrl,!0)&&((0,s.h)(i.s,this.order)||null===this.order)&&(0,s.i)("boolean",this.reverse)&&((0,s.T)(s.aI,this.scheduledStatus)||null===this.scheduledStatus)&&(0,s.h)(s.s,this.messageTypeFilter)},t.prototype.next=function(){return(0,s.j)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,s.k)(this,function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=s.V.of(this._iid).requestQueue,t=new nl((0,s.l)((0,s.l)({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=(n=a.sent().as(nc)).scheduledMessages,i=n.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.X),nd=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="groupChannel",t}return(0,s._)(t,e),t.prototype.init=function(t,n){var r=n.sdkState,s=n.dispatcher,i=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,l=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:s,sessionManager:i,requestQueue:a,logger:o,onlineDetector:u,cacheContext:l}),this._manager=new eB(t,{sdkState:r,cacheContext:l,dispatcher:s,sessionManager:i,requestQueue:a,logger:o})},t.prototype.createGroupChannelCollection=function(e){return void 0===e&&(e={}),new ns(this._iid,e)},t.prototype.createMyGroupChannelListQuery=function(e){return void 0===e&&(e={}),new eq(this._iid,e)},t.prototype.createPublicGroupChannelListQuery=function(e){return void 0===e&&(e={}),new no(this._iid,e)},t.prototype.createScheduledMessageListQuery=function(e){return void 0===e&&(e={}),new nh(this._iid,e)},t.prototype.addGroupChannelHandler=function(e,t){(0,s.u)((0,s.i)("string",e)&&t instanceof nu).throw(s.S.invalidParameters),this._manager.addHandler(e,t)},t.prototype.removeGroupChannelHandler=function(e){(0,s.u)((0,s.i)("string",e)).throw(s.S.invalidParameters),this._manager.removeHandler(e)},t.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},t.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},t.prototype.getChannel=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){return(0,s.u)((0,s.i)("string",e)).throw(s.S.invalidParameters),[2,this._manager.getChannel(e)]})})},t.prototype.getChannelWithoutCache=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){return(0,s.u)((0,s.i)("string",e)).throw(s.S.invalidParameters),[2,this._manager.getChannelWithoutCache(e)]})})},t.prototype.getMyGroupChannelChangeLogsByToken=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n;return(0,s.k)(this,function(r){switch(r.label){case 0:return n=(0,s.l)((0,s.l)({},D),t),(0,s.u)((0,s.i)("string",e)&&R(n)).throw(s.S.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}})})},t.prototype.getMyGroupChannelChangeLogsByTimestamp=function(e,t){return(0,s.j)(this,void 0,void 0,function(){var n;return(0,s.k)(this,function(r){switch(r.label){case 0:return n=(0,s.l)((0,s.l)({},D),t),(0,s.u)((0,s.i)("number",e)&&R(n)).throw(s.S.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}})})},t.prototype.getGroupChannelCount=function(e){return(0,s.j)(this,void 0,void 0,function(){var t;return(0,s.k)(this,function(n){return t=(0,s.l)((0,s.l)({},P),e),(0,s.u)(O(t)).throw(s.S.invalidParameters),[2,this._manager.getGroupChannelCount(t)]})})},t.prototype.getUnreadItemCount=function(e){return void 0===e&&(e={}),(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._manager.getUnreadItemCount(e)];case 1:return[2,t.sent()]}})})},t.prototype.getTotalUnreadChannelCount=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){switch(e.label){case 0:return[4,this._manager.getTotalUnreadChannelCount()];case 1:return[2,e.sent()]}})})},t.prototype.getTotalUnreadMessageCount=function(e){return void 0===e&&(e={}),(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,t.sent()]}})})},t.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return[4,this._manager.getTotalScheduledMessageCount(e)];case 1:return[2,t.sent()]}})})},t.prototype.getSubscribedTotalUnreadMessageCount=function(){return this._manager.getSubscribedTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)},t.prototype.createChannel=function(e){return void 0===e&&(e={}),(0,s.j)(this,void 0,void 0,function(){var t;return(0,s.k)(this,function(n){return t=(0,s.l)((0,s.l)({},k),e),(0,s.u)(L(t)).throw(s.S.invalidParameters),[2,this._manager.createChannel(t)]})})},t.prototype.createDistinctChannelIfNotExist=function(e){return void 0===e&&(e={}),(0,s.j)(this,void 0,void 0,function(){var t;return(0,s.k)(this,function(n){return t=(0,s.l)((0,s.l)({},k),e),(0,s.u)(L(t)).throw(s.S.invalidParameters),t&&(t.isDistinct=!0),[2,this.createChannel(t)]})})},t.prototype.createChannelWithUserIds=function(e,t,n,r,i,a){return void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=""),void 0===a&&(a=""),(0,s.j)(this,void 0,void 0,function(){var o;return(0,s.k)(this,function(u){return o=(0,s.l)((0,s.l)({},k),{invitedUserIds:e,isDistinct:t,name:n,data:i,customType:a}),"string"==typeof r?o.coverUrl=r:o.coverImage=r,[2,this.createChannel(o)]})})},t.prototype.markAsReadAll=function(){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(e){return this._manager.markAsReadAll(),[2]})})},t.prototype.markAsReadWithChannelUrls=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){return(0,s.u)((0,s.T)("string",e)).throw(s.S.invalidParameters),this._manager.markAsReadWithChannelUrls(e),[2]})})},t.prototype.markAsDelivered=function(e){return(0,s.j)(this,void 0,void 0,function(){return(0,s.k)(this,function(t){switch(t.label){case 0:return(0,s.u)((0,s.i)("string",e)).throw(s.S.invalidParameters),[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}})})},t}(s.o)}}]);